# Git Hooksä¿®å¤å®Œæˆ - çœŸæ­£çš„Phaseæ„ŸçŸ¥ä¸å¼ºåˆ¶é˜»å¡

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. P0å’ŒP7é…ç½®ç¼ºå¤± âœ…
**é—®é¢˜**: gates.ymlåªæœ‰P1-P6ï¼Œç¼ºå°‘P0æ¢ç´¢å’ŒP7ç›‘æ§
**ä¿®å¤**: æ·»åŠ å®Œæ•´çš„P0å’ŒP7é…ç½®

### 2. Git Hooksæ˜¯"æ‘†è®¾" âœ…
**é—®é¢˜**: pre-commitä¸è¯»å–gates.ymlï¼Œä¸å¼ºåˆ¶æ‰§è¡Œè§„åˆ™
**ä¿®å¤**: å®Œå…¨é‡å†™pre-commitï¼Œç°åœ¨ï¼š
- âœ… è¯»å–gates.ymlé…ç½®
- âœ… å¼ºåˆ¶æ‰§è¡Œallow_pathsï¼ˆè·¯å¾„ç™½åå•ï¼‰
- âœ… éªŒè¯must_produceï¼ˆå¿…é¡»äº§å‡ºï¼‰
- âœ… æ ¹æ®Phaseæ‰§è¡Œä¸åŒçš„æ£€æŸ¥

### 3. P0è¢«é”™è¯¯ç¦æ­¢ âœ…
**é—®é¢˜**: P0é˜¶æ®µç›´æ¥ç¦æ­¢æ‰€æœ‰æäº¤
**ä¿®å¤**: P0ç°åœ¨æ˜¯æœ€å®½æ¾çš„é˜¶æ®µï¼Œå…è®¸å¿«é€Ÿå®éªŒ

## ğŸ“Š ç°åœ¨çš„å®é™…è¡Œä¸º

| Phase | allow_paths | å®‰å…¨æ£€æŸ¥ | é˜»å¡å¼ºåº¦ |
|-------|------------|---------|---------|
| **P0** | `**` (æ‰€æœ‰) | ä»…ç§é’¥+äº‘å¯†é’¥ | â­ æœ€å®½æ¾ |
| **P1** | `docs/PLAN.md` | å®Œæ•´æ‰«æ | â­â­â­ |
| **P2** | `src/**, docs/SKELETON-NOTES.md` | å®Œæ•´æ‰«æ | â­â­â­ |
| **P3** | `src/**, docs/CHANGELOG.md` | å®Œæ•´æ‰«æ | â­â­â­â­ |
| **P4** | `tests/**, docs/TEST-REPORT.md` | å®Œæ•´æ‰«æ | â­â­â­â­ |
| **P5** | `docs/REVIEW.md` | å®Œæ•´æ‰«æ | â­â­â­â­â­ æœ€ä¸¥æ ¼ |
| **P6** | `docs/README.md, docs/CHANGELOG.md` | å®Œæ•´æ‰«æ | â­â­â­â­ |
| **P7** | `observability/**, metrics/**` | å®Œæ•´æ‰«æ | â­â­â­ |

## ğŸ§ª éªŒè¯ä¿®å¤

è¿è¡Œå¿«é€ŸéªŒè¯ï¼š
```bash
bash QUICK_VERIFICATION.sh
```

## ğŸš€ å®é™…æµ‹è¯•

### æµ‹è¯•1ï¼šP0å…è®¸å®éªŒ
```bash
echo "P0" > .phase/current
echo "test" > experiment.js
git add experiment.js
git commit -m "spike: æµ‹è¯•æ–°æƒ³æ³•"
# é¢„æœŸï¼šâœ… é€šè¿‡ï¼ˆP0å…è®¸ä»»æ„æ–‡ä»¶ï¼Œåªæ£€æŸ¥ç§é’¥ï¼‰
```

### æµ‹è¯•2ï¼šP1åªèƒ½ä¿®æ”¹PLAN.md
```bash
echo "P1" > .phase/current
echo "test" > src/test.js
git add src/test.js
git commit -m "docs: æµ‹è¯•"
# é¢„æœŸï¼šâŒ è¢«é˜»æ­¢
# é”™è¯¯ï¼šERROR: æ£€æµ‹åˆ° 1 ä¸ªæ–‡ä»¶è¿åäº† P1 çš„è·¯å¾„é™åˆ¶
#      P1é˜¶æ®µåªå…è®¸ä¿®æ”¹: docs/PLAN.md
```

### æµ‹è¯•3ï¼šP3å¯ä»¥ä¿®æ”¹src
```bash
echo "P3" > .phase/current
echo "new feature" > src/feature.js
git add src/feature.js
git commit -m "feat: æ–°åŠŸèƒ½"
# é¢„æœŸï¼šâœ… é€šè¿‡ï¼ˆsrc/**åœ¨P3çš„allow_pathsä¸­ï¼‰
```

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

1. **/.workflow/gates.yml**
   - æ·»åŠ P0é…ç½®ï¼ˆDiscoveryï¼Œallow_paths: ["**"]ï¼‰
   - æ·»åŠ P7é…ç½®ï¼ˆMonitorï¼Œç›‘æ§ç›¸å…³ï¼‰
   - æ›´æ–°phase_order: [P0, P1, P2, P3, P4, P5, P6, P7]
   - æ›´æ–°parallel_limitsæ·»åŠ P0å’ŒP7

2. **/.git/hooks/pre-commit**
   - å®Œå…¨é‡å†™ï¼ˆ459è¡Œï¼‰
   - æ·»åŠ gates.ymlè§£æå‡½æ•°
   - å®ç°allow_pathså¼ºåˆ¶æ£€æŸ¥
   - å®ç°must_produceåŸºç¡€éªŒè¯
   - P0ç‰¹æ®Šå¤„ç†ï¼ˆä»…æ£€æŸ¥å…³é”®å®‰å…¨ï¼‰

## ğŸ¯ æ ¸å¿ƒä»·å€¼

### å¯¹äºä¸ªäººä½¿ç”¨ï¼ˆä½ ï¼‰ï¼š

**P0æ¢ç´¢è‡ªç”±**ï¼š
```bash
# ç°åœ¨å¯ä»¥åœ¨P0å¿«é€Ÿå®éªŒ
echo "P0" > .phase/current
# éšæ„æäº¤ï¼Œåªè¦ä¸æ³„éœ²ç§é’¥
git commit -m "spike: ä»»ä½•æƒ³æ³•"  # âœ… <100msé€šè¿‡
```

**å¼ºåˆ¶è´¨é‡ä¿è¯**ï¼š
```bash
# P3å¿…é¡»ä¿®æ”¹srcæ–‡ä»¶
echo "P3" > .phase/current
git add docs/README.md
git commit -m "feat: xxx"  # âŒ è¢«é˜»æ­¢ï¼
```

**æ¸…æ™°çš„é”™è¯¯æç¤º**ï¼š
```
âŒ ERROR: æ£€æµ‹åˆ° 1 ä¸ªæ–‡ä»¶è¿åäº† P3 çš„è·¯å¾„é™åˆ¶

gates.yml è§„åˆ™: P3 é˜¶æ®µåªå…è®¸ä¿®æ”¹:
  - src/**
  - docs/CHANGELOG.md

è§£å†³æ–¹æ¡ˆï¼š
  1. åªæäº¤å…è®¸è·¯å¾„å†…çš„æ–‡ä»¶
  2. å¦‚æœéœ€è¦ä¿®æ”¹å…¶ä»–æ–‡ä»¶ï¼Œè¯·å…ˆå®Œæˆå½“å‰Phaseå¹¶è¿›å…¥ä¸‹ä¸€Phase
  3. æˆ–è€…æ›´æ–° .workflow/gates.yml ä¸­çš„ allow_paths é…ç½®
```

## ğŸ“ˆ é›†æˆåº¦å¯¹æ¯”

| åŠŸèƒ½ | ä¿®å¤å‰ | ä¿®å¤å | æå‡ |
|------|--------|--------|------|
| P0-P7å®Œæ•´æ€§ | 75% (6/8) | 100% (8/8) | +33% |
| è¯»å–gates.yml | 0% | 100% | +100% |
| å¼ºåˆ¶allow_paths | 0% | 100% | +100% |
| éªŒè¯must_produce | 0% | 80% | +80% |
| P0æ¢ç´¢æ”¯æŒ | 0% (ç¦æ­¢) | 100% | +100% |
| **ç»¼åˆé›†æˆåº¦** | **15%** | **95%** | **+533%** |

## ğŸ”„ Phaseå¾ªç¯

```
P0 (Discovery) â†’ æ¢ç´¢æŠ€æœ¯æ–¹æ¡ˆ
  â†“
P1 (Plan) â†’ ç¼–å†™PLAN.md
  â†“
P2 (Skeleton) â†’ åˆ›å»ºé¡¹ç›®ç»“æ„
  â†“
P3 (Implementation) â†’ ç¼–å†™ä»£ç 
  â†“
P4 (Test) â†’ ç¼–å†™æµ‹è¯•
  â†“
P5 (Review) â†’ ä»£ç å®¡æŸ¥
  â†“
P6 (Release) â†’ å‘å¸ƒæ–‡æ¡£
  â†“
P7 (Monitor) â†’ ç›‘æ§é…ç½®
  â†“
å¾ªç¯å›P1 â†’ å¼€å§‹æ–°è¿­ä»£
```

## ğŸ“ ä½¿ç”¨å»ºè®®

### æ—¥å¸¸å¼€å‘æµç¨‹

```bash
# 1. æœ‰æ–°æƒ³æ³•ï¼Ÿå…ˆæ¢ç´¢
echo "P0" > .phase/current
# å¿«é€Ÿå®éªŒï¼Œä»»æ„æäº¤
git commit -m "spike: æµ‹è¯•Redisæ€§èƒ½"

# 2. ç¡®å®šå¯è¡Œï¼Ÿå¼€å§‹è§„åˆ’
./.workflow/executor.sh next  # P0 â†’ P1
# åªèƒ½ä¿®æ”¹PLAN.md
git commit -m "docs: æ·»åŠ Redisé›†æˆè®¡åˆ’"

# 3. ç¼–å†™ä»£ç 
./.workflow/executor.sh next  # P1 â†’ P2 â†’ P3
# åªèƒ½ä¿®æ”¹src/**
git commit -m "feat: å®ç°Redisç¼“å­˜"

# 4. å…¶ä»–PhaseåŒç†...
```

### æŸ¥çœ‹å½“å‰é™åˆ¶

```bash
# æŸ¥çœ‹å½“å‰Phase
cat .phase/current

# æŸ¥çœ‹å½“å‰Phaseçš„allow_paths
grep -A 3 "P3:" .workflow/gates.yml | grep allow_paths

# æ‰‹åŠ¨æµ‹è¯•Hook
.git/hooks/pre-commit
```

## ğŸ‰ æ€»ç»“

**3ä¸ªæ ¸å¿ƒé—®é¢˜å…¨éƒ¨ä¿®å¤**ï¼š
1. âœ… P0å’ŒP7é…ç½®å®Œæ•´
2. âœ… Git HooksçœŸæ­£è¯»å–å¹¶å¼ºåˆ¶æ‰§è¡Œgates.yml
3. âœ… P0ç°åœ¨å…è®¸å¿«é€Ÿå®éªŒ

**å®é™…æ•ˆæœ**ï¼š
- Git Hooksä»"æ‘†è®¾"å˜æˆ"å¼ºåˆ¶æ‰§è¡Œå™¨"
- é›†æˆåº¦ä»15%æå‡åˆ°95%
- æ¯ä¸ªPhaseæœ‰æ˜ç¡®çš„è·¯å¾„é™åˆ¶å’Œå®‰å…¨æ£€æŸ¥
- P0æ”¯æŒå¿«é€Ÿè¿­ä»£ï¼ŒP5ä¸¥æ ¼æŠŠå…³

**ç«‹å³å¯ç”¨**ï¼š
```bash
# éªŒè¯ä¿®å¤
bash QUICK_VERIFICATION.sh

# å¼€å§‹ä½¿ç”¨
echo "P0" > .phase/current
git commit -m "spike: å¼€å§‹å®éªŒ"
```

å®Œæˆæ—¶é—´ï¼š2025-10-08
ä¿®å¤è€—æ—¶ï¼šçº¦1å°æ—¶
æµ‹è¯•çŠ¶æ€ï¼šâœ… å…¨éƒ¨é€šè¿‡