# Claude Enhancer v2.0 架构基础

> 制定日期：2025-09-23
> 版本：v2.0
> 状态：生效中

## 🏗️ 架构概览

Claude Enhancer采用**四层智能分层架构**，从内核到特性逐层构建，确保系统既稳定又灵活。

```
.claude/
├── core/         # L0: 内核层（5%）
├── framework/    # L1: 框架层（15%）
├── services/     # L2: 服务层（20%）
└── features/     # L3: 特性层（60%+）
```

## 📊 四层架构（L0-L3）

### L0: Core（内核层）
**职责**：系统最核心、永恒不变的部分
- `engine.py` - 工作流引擎（8-Phase执行器）
- `orchestrator.py` - Agent协调器
- `config.yaml` - 核心配置

**变更频率**：极低（主版本号变更）

### L1: Framework（框架层）
**职责**：主要框架功能，提供标准化的工作模式
- `workflow/` - 8-Phase工作流实现
- `strategies/` - 4-6-8 Agent策略
- `hooks/` - 基础Git hooks

**变更频率**：低（次版本号变更）

### L2: Services（服务层）
**职责**：共享服务模块，被features调用
- `validation/` - 验证服务
- `formatting/` - 格式化服务
- `analysis/` - 分析服务
- `utils/` - 通用工具

**变更频率**：中（补丁版本号变更）

### L3: Features（特性层）
**职责**：所有功能特性，持续增长的部分

```
features/
├── basic/       # 基础特性（简单，单文件）
├── standard/    # 标准特性（中等，文件夹组织）
└── advanced/    # 高级特性（复杂，可内部分层）
```

**变更频率**：高（日常迭代）

## 🎯 设计原则

### 1. 渐进式复杂度
- 小feature保持简单（单文件）
- 中feature适度组织（文件夹）
- 大feature充分结构（内部分层）

### 2. 清晰的依赖关系
```
L0 ← L1 ← L2 ← L3
内核 ← 框架 ← 服务 ← 特性
```
- 下层不依赖上层
- 上层可调用下层
- 同层可互相调用

### 3. 成长路径明确
```
basic/quick_fix.py (10行)
    ↓ 功能增加
standard/quick_fix/ (100行)
    ↓ 变复杂了
advanced/smart_fix/
    ├── core/
    ├── main/
    └── modules/
```

## 📈 版本策略

```yaml
claude_enhancer:
  version: 2.3.15
  # X.0.0 - Core变更（架构级）
  # 2.X.0 - Framework变更（功能级）
  # 2.3.X - Services/Features变更（日常级）
```

## 🚀 实际应用示例

### 示例1：添加新的简单特性
```bash
# 添加到 features/basic/
features/basic/auto_commit.py  # 简单的自动提交功能
```

### 示例2：添加中等复杂特性
```bash
# 添加到 features/standard/
features/standard/code_review/
├── reviewer.py
├── rules.yaml
└── templates/
```

### 示例3：添加复杂特性系统
```bash
# 添加到 features/advanced/
features/advanced/ai_assistant/
├── core/           # AI核心逻辑
│   └── engine.py
├── main/           # 主要功能
│   └── assistant.py
└── modules/        # 辅助模块
    └── prompts/
```

## 🔄 迁移策略

从当前结构迁移到v2.0架构：

1. **保留**：`core/` 保持最小化
2. **重命名**：`main/` → `framework/`
3. **重命名**：`modules/` → `services/`
4. **重组**：`features/` 按复杂度分类
5. **新增**：`ARCHITECTURE/` 永久文档

## 💡 设计智慧

> "简单的事物应该简单，复杂的事物应该可能。"
>
> Claude Enhancer的架构让小功能保持轻量，
> 同时为大型特性提供足够的组织空间。

---
*架构设计：基于个人IDE需求，追求实用和可成长*
*下次评审：当features/超过100个特性时*