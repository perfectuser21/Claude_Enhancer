#!/bin/bash
# Claude Enhancer Git Hook - Commit Message
# æ£€æŸ¥æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆè§„èŒƒ

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo "ğŸ” Claude Enhancer Commit Message Check"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# æ£€æŸ¥æäº¤ä¿¡æ¯æ ¼å¼
# æ ¼å¼: type(scope): description
# æˆ–è€…: type: description
PATTERN="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,100}"

if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
    echo -e "${RED}âŒ Invalid commit message format!${NC}"
    echo ""
    echo "Expected format:"
    echo "  type(scope): description"
    echo "  type: description"
    echo ""
    echo "Types:"
    echo "  feat     - New feature"
    echo "  fix      - Bug fix"
    echo "  docs     - Documentation"
    echo "  style    - Code style"
    echo "  refactor - Code refactoring"
    echo "  test     - Tests"
    echo "  chore    - Chores"
    echo "  perf     - Performance"
    echo "  ci       - CI/CD"
    echo "  build    - Build system"
    echo "  revert   - Revert commit"
    echo ""
    echo "Examples:"
    echo "  feat: add user authentication"
    echo "  fix(auth): resolve login timeout issue"
    echo "  docs: update API documentation"
    echo ""
    echo "Your message:"
    echo "  $COMMIT_MSG"
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦æåˆ°ä½¿ç”¨äº†å¤šå°‘agentsï¼ˆå¯é€‰ï¼‰
if echo "$COMMIT_MSG" | grep -qE "[0-9]+ agents?"; then
    echo -e "${GREEN}âœ… Agent collaboration mentioned${NC}"
fi

# æ£€æŸ¥æ˜¯å¦è¿‡é•¿
MSG_LENGTH=${#COMMIT_MSG}
if [ $MSG_LENGTH -gt 200 ]; then
    echo -e "${YELLOW}âš ï¸  Commit message is long ($MSG_LENGTH chars)${NC}"
    echo "   Consider adding details to the commit body instead"
fi

echo -e "${GREEN}âœ… Commit message format OK${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

exit 0