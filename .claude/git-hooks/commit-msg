#!/bin/bash
# Claude Enhancer Git Hook - Commit Message
# 检查提交信息是否符合规范

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# 颜色定义
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo "🔍 Claude Enhancer Commit Message Check"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

# 检查提交信息格式
# 格式: type(scope): description
# 或者: type: description
PATTERN="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,100}"

if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
    echo -e "${RED}❌ Invalid commit message format!${NC}"
    echo ""
    echo "Expected format:"
    echo "  type(scope): description"
    echo "  type: description"
    echo ""
    echo "Types:"
    echo "  feat     - New feature"
    echo "  fix      - Bug fix"
    echo "  docs     - Documentation"
    echo "  style    - Code style"
    echo "  refactor - Code refactoring"
    echo "  test     - Tests"
    echo "  chore    - Chores"
    echo "  perf     - Performance"
    echo "  ci       - CI/CD"
    echo "  build    - Build system"
    echo "  revert   - Revert commit"
    echo ""
    echo "Examples:"
    echo "  feat: add user authentication"
    echo "  fix(auth): resolve login timeout issue"
    echo "  docs: update API documentation"
    echo ""
    echo "Your message:"
    echo "  $COMMIT_MSG"
    exit 1
fi

# 检查是否提到使用了多少agents（可选）
if echo "$COMMIT_MSG" | grep -qE "[0-9]+ agents?"; then
    echo -e "${GREEN}✅ Agent collaboration mentioned${NC}"
fi

# 检查是否过长
MSG_LENGTH=${#COMMIT_MSG}
if [ $MSG_LENGTH -gt 200 ]; then
    echo -e "${YELLOW}⚠️  Commit message is long ($MSG_LENGTH chars)${NC}"
    echo "   Consider adding details to the commit body instead"
fi

echo -e "${GREEN}✅ Commit message format OK${NC}"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

exit 0