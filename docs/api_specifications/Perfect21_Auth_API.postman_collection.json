{
  "info": {
    "name": "Perfect21 Authentication API",
    "description": "Perfect21è®¤è¯APIå®Œæ•´æµ‹è¯•é›†åˆï¼ŒåŒ…å«ç™»å½•ã€ä»¤ç‰Œç®¡ç†ã€ç”¨æˆ·ä¿¡æ¯èŽ·å–ç­‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ç”¨ä¾‹ã€‚",
    "version": "1.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8000/api/auth",
      "type": "string",
      "description": "APIåŸºç¡€URL"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string",
      "description": "è®¿é—®ä»¤ç‰Œï¼ˆç™»å½•åŽè‡ªåŠ¨è®¾ç½®ï¼‰"
    },
    {
      "key": "refresh_token",
      "value": "",
      "type": "string",
      "description": "åˆ·æ–°ä»¤ç‰Œï¼ˆç™»å½•åŽè‡ªåŠ¨è®¾ç½®ï¼‰"
    },
    {
      "key": "user_id",
      "value": "",
      "type": "string",
      "description": "ç”¨æˆ·IDï¼ˆç™»å½•åŽè‡ªåŠ¨è®¾ç½®ï¼‰"
    }
  ],
  "item": [
    {
      "name": "1. ç”¨æˆ·ç™»å½•",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// æ£€æŸ¥å“åº”çŠ¶æ€",
              "pm.test('ç™»å½•è¯·æ±‚çŠ¶æ€ä¸º200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// è§£æžå“åº”æ•°æ®",
              "const responseJson = pm.response.json();",
              "",
              "// æ£€æŸ¥å“åº”ç»“æž„",
              "pm.test('å“åº”åŒ…å«å¿…è¦å­—æ®µ', () => {",
              "    pm.expect(responseJson).to.have.property('success');",
              "    pm.expect(responseJson).to.have.property('message');",
              "});",
              "",
              "// å¦‚æžœç™»å½•æˆåŠŸï¼Œä¿å­˜ä»¤ç‰Œ",
              "if (responseJson.success) {",
              "    pm.test('ç™»å½•æˆåŠŸ', () => {",
              "        pm.expect(responseJson.success).to.be.true;",
              "        pm.expect(responseJson).to.have.property('access_token');",
              "        pm.expect(responseJson).to.have.property('refresh_token');",
              "        pm.expect(responseJson).to.have.property('user');",
              "    });",
              "    ",
              "    // ä¿å­˜ä»¤ç‰Œåˆ°çŽ¯å¢ƒå˜é‡",
              "    pm.collectionVariables.set('access_token', responseJson.access_token);",
              "    pm.collectionVariables.set('refresh_token', responseJson.refresh_token);",
              "    pm.collectionVariables.set('user_id', responseJson.user.id);",
              "    ",
              "    console.log('ðŸŽ‰ ç™»å½•æˆåŠŸï¼Œä»¤ç‰Œå·²ä¿å­˜');",
              "} else {",
              "    pm.test('ç™»å½•å¤±è´¥åŽŸå› ', () => {",
              "        console.log('âŒ ç™»å½•å¤±è´¥: ' + responseJson.message);",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"identifier\": \"user@example.com\",\n  \"password\": \"password123\",\n  \"remember_me\": false\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/login",
          "host": ["{{baseUrl}}"],
          "path": ["login"]
        },
        "description": "ç”¨æˆ·ç™»å½•æŽ¥å£æµ‹è¯•ã€‚ä½¿ç”¨é‚®ç®±/ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ï¼ŒæˆåŠŸåŽèŽ·å–è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œã€‚"
      }
    },
    {
      "name": "2. èŽ·å–å½“å‰ç”¨æˆ·ä¿¡æ¯",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// æ£€æŸ¥å“åº”çŠ¶æ€",
              "pm.test('èŽ·å–ç”¨æˆ·ä¿¡æ¯çŠ¶æ€ä¸º200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// è§£æžå“åº”æ•°æ®",
              "const responseJson = pm.response.json();",
              "",
              "// æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯ç»“æž„",
              "pm.test('ç”¨æˆ·ä¿¡æ¯åŒ…å«å¿…è¦å­—æ®µ', () => {",
              "    pm.expect(responseJson).to.have.property('id');",
              "    pm.expect(responseJson).to.have.property('username');",
              "    pm.expect(responseJson).to.have.property('email');",
              "    pm.expect(responseJson).to.have.property('role');",
              "});",
              "",
              "// éªŒè¯æ•°æ®ç±»åž‹",
              "pm.test('ç”¨æˆ·ä¿¡æ¯æ•°æ®ç±»åž‹æ­£ç¡®', () => {",
              "    pm.expect(responseJson.id).to.be.a('string');",
              "    pm.expect(responseJson.username).to.be.a('string');",
              "    pm.expect(responseJson.email).to.include('@');",
              "    pm.expect(['user', 'admin', 'moderator']).to.include(responseJson.role);",
              "});",
              "",
              "console.log('âœ… ç”¨æˆ·ä¿¡æ¯èŽ·å–æˆåŠŸ:', responseJson.username);"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// æ£€æŸ¥æ˜¯å¦æœ‰è®¿é—®ä»¤ç‰Œ",
              "const accessToken = pm.collectionVariables.get('access_token');",
              "if (!accessToken) {",
              "    console.log('âš ï¸ è­¦å‘Š: æ²¡æœ‰è®¿é—®ä»¤ç‰Œï¼Œè¯·å…ˆæ‰§è¡Œç™»å½•è¯·æ±‚');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{access_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/me",
          "host": ["{{baseUrl}}"],
          "path": ["me"]
        },
        "description": "èŽ·å–å½“å‰å·²è®¤è¯ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æä¾›æœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œã€‚"
      }
    },
    {
      "name": "3. åˆ·æ–°è®¿é—®ä»¤ç‰Œ",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// æ£€æŸ¥å“åº”çŠ¶æ€",
              "pm.test('åˆ·æ–°ä»¤ç‰ŒçŠ¶æ€ä¸º200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// è§£æžå“åº”æ•°æ®",
              "const responseJson = pm.response.json();",
              "",
              "// æ£€æŸ¥å“åº”ç»“æž„",
              "pm.test('åˆ·æ–°å“åº”åŒ…å«å¿…è¦å­—æ®µ', () => {",
              "    pm.expect(responseJson).to.have.property('success');",
              "    pm.expect(responseJson).to.have.property('message');",
              "});",
              "",
              "// å¦‚æžœåˆ·æ–°æˆåŠŸï¼Œæ›´æ–°ä»¤ç‰Œ",
              "if (responseJson.success) {",
              "    pm.test('ä»¤ç‰Œåˆ·æ–°æˆåŠŸ', () => {",
              "        pm.expect(responseJson.success).to.be.true;",
              "        pm.expect(responseJson).to.have.property('access_token');",
              "        pm.expect(responseJson).to.have.property('expires_in');",
              "    });",
              "    ",
              "    // æ›´æ–°è®¿é—®ä»¤ç‰Œ",
              "    pm.collectionVariables.set('access_token', responseJson.access_token);",
              "    ",
              "    console.log('ðŸ”„ ä»¤ç‰Œåˆ·æ–°æˆåŠŸ');",
              "} else {",
              "    pm.test('ä»¤ç‰Œåˆ·æ–°å¤±è´¥åŽŸå› ', () => {",
              "        console.log('âŒ ä»¤ç‰Œåˆ·æ–°å¤±è´¥: ' + responseJson.message);",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// æ£€æŸ¥æ˜¯å¦æœ‰åˆ·æ–°ä»¤ç‰Œ",
              "const refreshToken = pm.collectionVariables.get('refresh_token');",
              "if (!refreshToken) {",
              "    console.log('âš ï¸ è­¦å‘Š: æ²¡æœ‰åˆ·æ–°ä»¤ç‰Œï¼Œè¯·å…ˆæ‰§è¡Œç™»å½•è¯·æ±‚');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"refresh_token\": \"{{refresh_token}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/refresh",
          "host": ["{{baseUrl}}"],
          "path": ["refresh"]
        },
        "description": "ä½¿ç”¨æœ‰æ•ˆçš„åˆ·æ–°ä»¤ç‰ŒèŽ·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚åˆ·æ–°ä»¤ç‰Œæ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨çš„ã€‚"
      }
    },
    {
      "name": "4. ç”¨æˆ·ç™»å‡º",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// æ£€æŸ¥å“åº”çŠ¶æ€",
              "pm.test('ç™»å‡ºè¯·æ±‚çŠ¶æ€ä¸º200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// è§£æžå“åº”æ•°æ®",
              "const responseJson = pm.response.json();",
              "",
              "// æ£€æŸ¥ç™»å‡ºç»“æžœ",
              "pm.test('ç™»å‡ºæˆåŠŸ', () => {",
              "    pm.expect(responseJson).to.have.property('success');",
              "    pm.expect(responseJson.success).to.be.true;",
              "    pm.expect(responseJson).to.have.property('message');",
              "});",
              "",
              "// æ¸…é™¤ä¿å­˜çš„ä»¤ç‰Œ",
              "pm.collectionVariables.set('access_token', '');",
              "pm.collectionVariables.set('refresh_token', '');",
              "pm.collectionVariables.set('user_id', '');",
              "",
              "console.log('ðŸ‘‹ ç™»å‡ºæˆåŠŸï¼Œä»¤ç‰Œå·²æ¸…é™¤');"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// æ£€æŸ¥æ˜¯å¦æœ‰è®¿é—®ä»¤ç‰Œ",
              "const accessToken = pm.collectionVariables.get('access_token');",
              "if (!accessToken) {",
              "    console.log('âš ï¸ è­¦å‘Š: æ²¡æœ‰è®¿é—®ä»¤ç‰Œï¼Œè¯·å…ˆæ‰§è¡Œç™»å½•è¯·æ±‚');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{access_token}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/logout",
          "host": ["{{baseUrl}}"],
          "path": ["logout"]
        },
        "description": "ç™»å‡ºå½“å‰ç”¨æˆ·ï¼Œä½¿è®¿é—®ä»¤ç‰Œç«‹å³å¤±æ•ˆå¹¶åŠ å…¥é»‘åå•ã€‚"
      }
    },
    {
      "name": "5. å¥åº·æ£€æŸ¥",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// æ£€æŸ¥å“åº”çŠ¶æ€",
              "pm.test('å¥åº·æ£€æŸ¥çŠ¶æ€ä¸º200', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// è§£æžå“åº”æ•°æ®",
              "const responseJson = pm.response.json();",
              "",
              "// æ£€æŸ¥å¥åº·çŠ¶æ€",
              "pm.test('æœåŠ¡å¥åº·çŠ¶æ€æ­£å¸¸', () => {",
              "    pm.expect(responseJson).to.have.property('status');",
              "    pm.expect(responseJson.status).to.equal('healthy');",
              "    pm.expect(responseJson).to.have.property('service');",
              "    pm.expect(responseJson.service).to.equal('auth');",
              "});",
              "",
              "console.log('âœ… è®¤è¯æœåŠ¡å¥åº·çŠ¶æ€æ­£å¸¸');"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": ["{{baseUrl}}"],
          "path": ["health"]
        },
        "description": "æ£€æŸ¥è®¤è¯æœåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œæ— éœ€è®¤è¯ã€‚"
      }
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// å…¨å±€é¢„è¯·æ±‚è„šæœ¬",
          "console.log('ðŸš€ æ‰§è¡ŒAPIè¯·æ±‚: ' + pm.info.requestName);",
          "",
          "// è®¾ç½®é€šç”¨è¯·æ±‚å¤´",
          "if (!pm.request.headers.has('User-Agent')) {",
          "    pm.request.headers.add({",
          "        key: 'User-Agent',",
          "        value: 'Perfect21-Postman-Tests/1.0'",
          "    });",
          "}",
          "",
          "// æ·»åŠ è¯·æ±‚IDç”¨äºŽè¿½è¸ª",
          "const requestId = 'req_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);",
          "pm.request.headers.add({",
          "    key: 'X-Request-Id',",
          "    value: requestId",
          "});"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// å…¨å±€åŽç½®è„šæœ¬",
          "console.log('ðŸ“Š å“åº”æ—¶é—´: ' + pm.response.responseTime + 'ms');",
          "console.log('ðŸ“„ å“åº”å¤§å°: ' + pm.response.responseSize + ' bytes');",
          "",
          "// æ£€æŸ¥é€šç”¨å“åº”å¤´",
          "pm.test('å“åº”åŒ…å«Content-Type', () => {",
          "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
          "});",
          "",
          "// æ€§èƒ½æµ‹è¯•",
          "pm.test('å“åº”æ—¶é—´å°äºŽ2ç§’', () => {",
          "    pm.expect(pm.response.responseTime).to.be.below(2000);",
          "});"
        ]
      }
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{access_token}}",
        "type": "string"
      }
    ]
  }
}