<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚁 VibePilot V2 - 网络连接指南</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        .access-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .method-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .method-card:hover {
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-5px);
        }
        .method-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .link-button {
            display: inline-block;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .link-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-left: 4px solid #667eea;
        }
        .diagnostic-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background-color: #4CAF50; }
        .status-offline { background-color: #f44336; }
        .status-testing { background-color: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚁 VibePilot V2 网络连接指南</h1>

        <div class="status-card">
            <h2>📊 服务器状态</h2>
            <p><span class="status-indicator status-online"></span>VibePilot V2 正在运行</p>
            <p><span class="status-indicator status-online"></span>所有端口已开放</p>
            <p><span class="status-indicator status-online"></span>防火墙已配置</p>
            <p id="serverTime">🕒 服务器时间: <span id="currentTime"></span></p>
        </div>

        <div class="access-methods">
            <div class="method-card">
                <div class="method-title">
                    🎯 方法1: 直接访问 (推荐先试)
                </div>
                <p>如果你的网络允许，直接访问VibePilot：</p>
                <a href="http://146.190.52.84:9999" class="link-button" target="_blank">
                    🌐 VibePilot主界面 (9999端口)
                </a>
                <a href="http://146.190.52.84:9999/health" class="link-button" target="_blank">
                    ❤️ 健康检查
                </a>
                <a href="http://146.190.52.84" class="link-button" target="_blank">
                    🌍 80端口访问
                </a>
            </div>

            <div class="method-card">
                <div class="method-title">
                    🔒 方法2: SSH隧道 (最稳定)
                </div>
                <p>如果直接访问不行，使用SSH隧道：</p>
                <div class="code-block">
ssh -L 9999:localhost:9999 root@146.190.52.84
                </div>
                <p>然后访问:</p>
                <a href="http://localhost:9999" class="link-button">
                    🏠 本地隧道访问
                </a>
            </div>

            <div class="method-card">
                <div class="method-title">
                    📱 方法3: 移动热点测试
                </div>
                <p>如果以上都不行，尝试用手机热点：</p>
                <ol style="margin: 10px 0; padding-left: 20px;">
                    <li>开启手机热点</li>
                    <li>电脑连接手机热点</li>
                    <li>重新访问 VibePilot</li>
                </ol>
                <p>这能排除是否为网络运营商限制</p>
            </div>

            <div class="method-card">
                <div class="method-title">
                    🛠️ 方法4: 客户端诊断
                </div>
                <p>下载诊断脚本到你的Mac运行：</p>
                <a href="http://146.190.52.84:8002/client_test.py" class="link-button" download>
                    📥 下载诊断脚本
                </a>
                <div class="code-block">
# 下载后运行：
python3 client_test.py
                </div>
            </div>
        </div>

        <div class="diagnostic-section">
            <h2>🔍 实时连接测试</h2>
            <p>测试从你的浏览器到VibePilot的连接：</p>

            <button class="test-button" onclick="testConnection()">🧪 测试连接</button>
            <button class="test-button" onclick="testHealth()">❤️ 测试健康状态</button>
            <button class="test-button" onclick="openVibePilot()">🚀 打开VibePilot</button>

            <div id="testResults" style="margin-top: 20px;"></div>
        </div>

        <div class="diagnostic-section">
            <h2>🔧 常见问题解决</h2>
            <details style="margin: 10px 0;">
                <summary style="cursor: pointer; font-weight: bold;">❓ 浏览器显示"无法连接"</summary>
                <div style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px;">
                    <p>原因可能是：</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>防火墙阻止了连接</li>
                        <li>网络运营商限制</li>
                        <li>企业网络策略</li>
                    </ul>
                    <p>解决方案：使用SSH隧道或切换网络</p>
                </div>
            </details>

            <details style="margin: 10px 0;">
                <summary style="cursor: pointer; font-weight: bold;">❓ SSH隧道连接不上</summary>
                <div style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px;">
                    <p>检查SSH连接：</p>
                    <div class="code-block">ssh root@146.190.52.84</div>
                    <p>如果SSH正常，再建立隧道</p>
                </div>
            </details>

            <details style="margin: 10px 0;">
                <summary style="cursor: pointer; font-weight: bold;">❓ 页面加载很慢</summary>
                <div style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px;">
                    <p>这通常是网络延迟问题，VibePilot功能不受影响。可以：</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>使用SSH隧道减少延迟</li>
                        <li>切换到更快的网络</li>
                        <li>等待页面完全加载</li>
                    </ul>
                </div>
            </details>
        </div>
    </div>

    <script>
        // 更新时间
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('zh-CN');
        }
        updateTime();
        setInterval(updateTime, 1000);

        // 测试连接
        async function testConnection() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>🔄 正在测试连接...</p>';

            const tests = [
                { name: '9999端口', url: 'http://146.190.52.84:9999' },
                { name: '健康检查', url: 'http://146.190.52.84:9999/health' },
                { name: '80端口', url: 'http://146.190.52.84' }
            ];

            let results = '<h3>📊 连接测试结果:</h3>';

            for (const test of tests) {
                try {
                    const startTime = performance.now();
                    const response = await fetch(test.url, {
                        method: 'HEAD',
                        mode: 'no-cors',
                        cache: 'no-cache'
                    });
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);

                    results += `<p>✅ ${test.name}: 连接成功 (${duration}ms)</p>`;
                } catch (error) {
                    results += `<p>❌ ${test.name}: 连接失败 - ${error.message}</p>`;
                }
            }

            resultsDiv.innerHTML = results;
        }

        // 测试健康状态
        async function testHealth() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>🔄 正在检查健康状态...</p>';

            try {
                const response = await fetch('http://146.190.52.84:9999/health');
                const data = await response.json();
                resultsDiv.innerHTML = `
                    <h3>❤️ 健康检查结果:</h3>
                    <p>✅ 状态: ${data.status}</p>
                    <p>🕒 时间: ${data.timestamp}</p>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h3>❤️ 健康检查结果:</h3>
                    <p>❌ 无法获取健康状态: ${error.message}</p>
                    <p>💡 建议使用SSH隧道访问</p>
                `;
            }
        }

        // 打开VibePilot
        function openVibePilot() {
            // 尝试多个URL
            const urls = [
                'http://146.190.52.84:9999',
                'http://146.190.52.84',
                'http://localhost:9999'
            ];

            urls.forEach((url, index) => {
                setTimeout(() => {
                    window.open(url, `_vibepilot_${index}`);
                }, index * 1000);
            });

            document.getElementById('testResults').innerHTML = `
                <h3>🚀 正在尝试打开VibePilot:</h3>
                <p>已尝试打开多个访问地址，请检查新打开的标签页</p>
                <p>如果都无法访问，请使用SSH隧道方法</p>
            `;
        }
    </script>
</body>
</html>