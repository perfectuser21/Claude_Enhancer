{
  "metadata": {
    "version": "1.0.0",
    "last_updated": "2025-10-18",
    "total_features": 12,
    "total_steps": 77,
    "description": "Mapping between Claude Enhancer core features and validation steps"
  },
  "features": {
    "workflow_validation": {
      "id": "F001",
      "name": "77-Step Workflow Validation System",
      "description": "Complete validation framework covering P0-P5 phases + global checks",
      "category": "core",
      "priority": "critical",
      "steps": ["P0_S001", "P0_S002", "P0_S003", "P0_S004", "P0_S005", "P0_S006", "P0_S007", "P0_S008",
                "P1_S001", "P1_S002", "P1_S003", "P1_S004", "P1_S005", "P1_S006", "P1_S007", "P1_S008", "P1_S009", "P1_S010", "P1_S011", "P1_S012",
                "P2_S001", "P2_S002", "P2_S003", "P2_S004", "P2_S005", "P2_S006", "P2_S007", "P2_S008", "P2_S009", "P2_S010", "P2_S011", "P2_S012", "P2_S013", "P2_S014", "P2_S015",
                "P3_S001", "P3_S002", "P3_S003", "P3_S004", "P3_S005", "P3_S006", "P3_S007", "P3_S008", "P3_S009", "P3_S010", "P3_S011", "P3_S012", "P3_S013", "P3_S014", "P3_S015",
                "P4_S001", "P4_S002", "P4_S003", "P4_S004", "P4_S005", "P4_S006", "P4_S007", "P4_S008", "P4_S009", "P4_S010",
                "P5_S001", "P5_S002", "P5_S003", "P5_S004", "P5_S005", "P5_S006", "P5_S007", "P5_S008", "P5_S009", "P5_S010", "P5_S011", "P5_S012", "P5_S013", "P5_S014", "P5_S015",
                "G002", "G003"],
      "impact_when_changed": "全系统影响，需要完整回归测试",
      "test_coverage": "100%"
    },
    "git_hooks": {
      "id": "F002",
      "name": "Git Hooks Integration",
      "description": "Pre-commit, commit-msg, pre-push hooks for quality enforcement",
      "category": "automation",
      "priority": "high",
      "steps": ["P2_S009", "P2_S010", "P3_S012", "G003"],
      "related_files": [
        ".git/hooks/pre-commit",
        ".git/hooks/commit-msg",
        ".git/hooks/pre-push"
      ],
      "impact_when_changed": "影响提交流程，需验证所有git操作",
      "test_coverage": "95%"
    },
    "branch_protection": {
      "id": "F003",
      "name": "Branch Protection System",
      "description": "4-layer defense: Git hooks + CI/CD + GitHub + Monitoring",
      "category": "security",
      "priority": "critical",
      "steps": ["P2_S009", "P2_S010", "P3_S012", "P4_S010", "G003"],
      "layers": [
        "Layer 1: Local Git Hooks (100% logic protection)",
        "Layer 2: CI/CD Verification (+30% monitoring)",
        "Layer 3: GitHub Branch Protection (+100% server-side)",
        "Layer 4: Continuous Monitoring (daily health checks)"
      ],
      "impact_when_changed": "安全关键，需要12场景压力测试验证",
      "test_coverage": "100%"
    },
    "phase_system": {
      "id": "F004",
      "name": "6-Phase Workflow System",
      "description": "P0 Discovery → P1 Planning → P2 Implementation → P3 Testing → P4 Review → P5 Release",
      "category": "core",
      "priority": "critical",
      "steps": ["P0_S001", "P0_S002", "P0_S003", "P0_S004", "P0_S005", "P0_S006", "P0_S007", "P0_S008",
                "P1_S001", "P1_S002", "P1_S003", "P1_S004", "P1_S005", "P1_S006", "P1_S007", "P1_S008", "P1_S009", "P1_S010", "P1_S011", "P1_S012",
                "P2_S001", "P2_S002", "P2_S003", "P2_S004", "P2_S005", "P2_S006", "P2_S007", "P2_S008", "P2_S009", "P2_S010", "P2_S011", "P2_S012", "P2_S013", "P2_S014", "P2_S015",
                "P3_S001", "P3_S002", "P3_S003", "P3_S004", "P3_S005", "P3_S006", "P3_S007", "P3_S008", "P3_S009", "P3_S010", "P3_S011", "P3_S012", "P3_S013", "P3_S014", "P3_S015",
                "P4_S001", "P4_S002", "P4_S003", "P4_S004", "P4_S005", "P4_S006", "P4_S007", "P4_S008", "P4_S009", "P4_S010",
                "P5_S001", "P5_S002", "P5_S003", "P5_S004", "P5_S005", "P5_S006", "P5_S007", "P5_S008", "P5_S009", "P5_S010", "P5_S011", "P5_S012", "P5_S013", "P5_S014", "P5_S015"],
      "phase_breakdown": {
        "P0": "8 steps - Discovery & acceptance checklist",
        "P1": "12 steps - Planning & architecture",
        "P2": "15 steps - Implementation with commits",
        "P3": "15 steps - Testing & static checks (Quality Gate)",
        "P4": "10 steps - Code review & audit (Quality Gate)",
        "P5": "15 steps - Release & monitoring"
      },
      "impact_when_changed": "核心工作流，影响所有开发流程",
      "test_coverage": "100%"
    },
    "impact_radius": {
      "id": "F005",
      "name": "Impact Radius Assessment (v6.5.1)",
      "description": "Automatic task risk evaluation and agent strategy recommendation",
      "category": "intelligence",
      "priority": "high",
      "steps": ["P0_S001", "P0_S002", "P1_S001"],
      "formula": "Radius = (Risk × 5) + (Complexity × 3) + (Scope × 2)",
      "thresholds": {
        "high_risk": "≥50 points → 6 agents",
        "medium_risk": "30-49 points → 3 agents",
        "low_risk": "0-29 points → 0 agents"
      },
      "accuracy": "86% (26/30 validated samples)",
      "related_files": [".claude/scripts/impact_radius_assessor.sh", ".workflow/impact_assessments/"],
      "impact_when_changed": "影响Agent选择策略，需要重新验证准确率",
      "test_coverage": "86%"
    },
    "quality_gates": {
      "id": "F006",
      "name": "Quality Gate System",
      "description": "P3 Testing Gate + P4 Review Gate (blocking checkpoints)",
      "category": "quality",
      "priority": "critical",
      "steps": ["P3_S001", "P3_S002", "P3_S003", "P3_S004", "P3_S005", "P3_S006", "P3_S007", "P3_S008", "P3_S009", "P3_S010", "P3_S011", "P3_S012", "P3_S013", "P3_S014", "P3_S015",
                "P4_S001", "P4_S002", "P4_S003", "P4_S004", "P4_S005", "P4_S006", "P4_S007", "P4_S008", "P4_S009", "P4_S010",
                "P5_S009"],
      "gates": {
        "P3_gate": "Technical Quality (bash syntax, shellcheck, complexity, hook perf, tests)",
        "P4_gate": "Code Quality (config integrity, version consistency, doc completeness, logic review)"
      },
      "blocking_principle": "任何gate失败都阻止进入下一Phase",
      "related_files": ["scripts/static_checks.sh", "scripts/pre_merge_audit.sh"],
      "impact_when_changed": "质量保障核心，需要完整测试验证",
      "test_coverage": "100%"
    },
    "anti_hollow": {
      "id": "F007",
      "name": "6-Layer Anti-Hollow Defense",
      "description": "防止空壳文件、占位符内容、缺失实现",
      "category": "quality",
      "priority": "high",
      "steps": ["P0_S008", "P1_S012", "P2_S012", "P3_S001", "P3_S002", "P3_S003", "P3_S004", "P4_S006"],
      "layers": [
        "Layer 1: Structure Validation (标题、表格、列表数量)",
        "Layer 2: Placeholder Detection (12个占位词关键字)",
        "Layer 3: Sample Data Validation (JSON文件格式有效)",
        "Layer 4: Executability Check (脚本可运行)",
        "Layer 5: Test Report Validation (覆盖率阈值)",
        "Layer 6: Evidence Traceability (.evidence/含hash+timestamp)"
      ],
      "placeholder_keywords": ["TODO", "FIXME", "待定", "占位", "稍后填写", "待补充", "TBD", "To be determined", "Coming soon", "Placeholder", "未实现", "待实现"],
      "impact_when_changed": "检测精度变化，需要验证误报/漏报率",
      "test_coverage": "100%"
    },
    "doc_management": {
      "id": "F008",
      "name": "Documentation Management (7 Core Docs Rule)",
      "description": "严格控制根目录文档数量，防止文档泛滥",
      "category": "organization",
      "priority": "medium",
      "steps": ["P4_S009", "P5_S003", "P5_S004"],
      "core_docs": [
        "README.md",
        "CLAUDE.md",
        "INSTALLATION.md",
        "ARCHITECTURE.md",
        "CONTRIBUTING.md",
        "CHANGELOG.md",
        "LICENSE.md"
      ],
      "rules": [
        "禁止在根目录创建新.md文件",
        "临时分析放在.temp/ (7天TTL)",
        "创建永久文档前必须询问用户"
      ],
      "impact_when_changed": "文档组织策略，需要更新pre_write_document.sh hook",
      "test_coverage": "90%"
    },
    "version_consistency": {
      "id": "F009",
      "name": "Version Consistency System",
      "description": "确保VERSION, settings.json, manifest.yml, package.json, CHANGELOG.md版本号完全一致",
      "category": "release",
      "priority": "high",
      "steps": ["P4_S007", "P5_S013"],
      "validated_files": [
        "VERSION",
        ".claude/settings.json",
        "manifest.yml",
        "package.json",
        "CHANGELOG.md"
      ],
      "enforcement": "Phase 4 pre_merge_audit.sh强制验证，不一致阻止进入Phase 5",
      "related_scripts": ["scripts/check_version_consistency.sh", "scripts/pre_merge_audit.sh"],
      "impact_when_changed": "发布流程关键，需要验证所有版本文件",
      "test_coverage": "100%"
    },
    "claude_hooks": {
      "id": "F010",
      "name": "Claude Hooks System",
      "description": "38个AI行为强制hooks (PreToolUse/PrePrompt/PostAction)",
      "category": "automation",
      "priority": "high",
      "steps": ["P0_S001", "P1_S001", "P2_S001", "P2_S009", "P2_S010", "P3_S001", "P4_S001", "P4_S003", "P5_S001"],
      "key_hooks": [
        "branch_helper.sh - 分支前置检查 (PreToolUse)",
        "smart_agent_selector.sh - 智能Agent选择",
        "quality_gate.sh - 质量门禁检查",
        "gap_scan.sh - 差距分析",
        "force_branch_check.sh - 强制分支验证",
        "code_writing_check.sh - 代码写入拦截",
        "pre_write_document.sh - 文档写入拦截",
        "workflow_enforcer.sh - 工作流强制执行"
      ],
      "total_hooks": 38,
      "impact_when_changed": "AI行为模式变化，需要完整行为测试",
      "test_coverage": "85%"
    },
    "static_checks": {
      "id": "F011",
      "name": "Static Checks System (Phase 3 Gate)",
      "description": "Bash语法、Shellcheck、复杂度、Hook性能、功能测试",
      "category": "quality",
      "priority": "critical",
      "steps": ["P3_S005", "P3_S006", "P3_S007", "P3_S008", "P3_S009", "P3_S010", "P3_S011", "P3_S012", "P3_S014"],
      "checks": [
        "Bash Syntax (bash -n)",
        "Shellcheck Linting (SC warnings)",
        "Code Complexity (>150 lines/function blocks)",
        "Hook Performance (<5s execution)",
        "Functional Tests (feature validation)"
      ],
      "blocking": "任何检查失败阻止进入Phase 4",
      "related_script": "scripts/static_checks.sh",
      "impact_when_changed": "质量标准变化，需要重新定义阈值",
      "test_coverage": "100%"
    },
    "pre_merge_audit": {
      "id": "F012",
      "name": "Pre-Merge Audit System (Phase 4 Gate)",
      "description": "合并前审计：配置完整性、遗留问题、文档规范、版本一致性",
      "category": "quality",
      "priority": "critical",
      "steps": ["P4_S003", "P4_S004", "P4_S005", "P4_S006", "P4_S007", "P4_S008", "P4_S009", "P4_S010"],
      "audits": [
        "Config Integrity (hooks注册、权限)",
        "Legacy Issues Scan (TODO/FIXME)",
        "Document Compliance (根目录≤7个.md)",
        "Version Consistency (5个文件版本号一致)",
        "Code Pattern Consistency (相似功能统一实现)",
        "Documentation Completeness (REVIEW.md >100行)"
      ],
      "blocking": "任何critical issue阻止进入Phase 5",
      "related_script": "scripts/pre_merge_audit.sh",
      "impact_when_changed": "审计标准变化，需要更新检查逻辑",
      "test_coverage": "100%"
    }
  },
  "step_to_features_mapping": {
    "P0_S001": ["F001", "F004", "F005", "F010"],
    "P0_S002": ["F001", "F004", "F005"],
    "P0_S003": ["F001", "F004"],
    "P0_S004": ["F001", "F004"],
    "P0_S005": ["F001", "F004"],
    "P0_S006": ["F001", "F004"],
    "P0_S007": ["F001", "F004"],
    "P0_S008": ["F001", "F004", "F007"],
    "P1_S001": ["F001", "F004", "F005", "F010"],
    "P1_S002": ["F001", "F004"],
    "P1_S003": ["F001", "F004"],
    "P1_S004": ["F001", "F004"],
    "P1_S005": ["F001", "F004"],
    "P1_S006": ["F001", "F004"],
    "P1_S007": ["F001", "F004"],
    "P1_S008": ["F001", "F004"],
    "P1_S009": ["F001", "F004"],
    "P1_S010": ["F001", "F004"],
    "P1_S011": ["F001", "F004"],
    "P1_S012": ["F001", "F004", "F007"],
    "P2_S001": ["F001", "F004", "F010"],
    "P2_S002": ["F001", "F004"],
    "P2_S003": ["F001", "F004"],
    "P2_S004": ["F001", "F004"],
    "P2_S005": ["F001", "F004"],
    "P2_S006": ["F001", "F004"],
    "P2_S007": ["F001", "F004"],
    "P2_S008": ["F001", "F004"],
    "P2_S009": ["F001", "F002", "F003", "F004", "F010"],
    "P2_S010": ["F001", "F002", "F003", "F004", "F010"],
    "P2_S011": ["F001", "F004"],
    "P2_S012": ["F001", "F004", "F007"],
    "P2_S013": ["F001", "F004"],
    "P2_S014": ["F001", "F004"],
    "P2_S015": ["F001", "F004"],
    "P3_S001": ["F001", "F004", "F006", "F007", "F010"],
    "P3_S002": ["F001", "F004", "F006", "F007"],
    "P3_S003": ["F001", "F004", "F006", "F007"],
    "P3_S004": ["F001", "F004", "F006", "F007"],
    "P3_S005": ["F001", "F004", "F006", "F011"],
    "P3_S006": ["F001", "F004", "F006", "F011"],
    "P3_S007": ["F001", "F004", "F006", "F011"],
    "P3_S008": ["F001", "F004", "F006", "F011"],
    "P3_S009": ["F001", "F004", "F006", "F011"],
    "P3_S010": ["F001", "F004", "F006", "F011"],
    "P3_S011": ["F001", "F004", "F006", "F011"],
    "P3_S012": ["F001", "F002", "F003", "F004", "F006", "F011"],
    "P3_S013": ["F001", "F004", "F006"],
    "P3_S014": ["F001", "F004", "F006", "F011"],
    "P3_S015": ["F001", "F004", "F006"],
    "P4_S001": ["F001", "F004", "F006", "F010"],
    "P4_S002": ["F001", "F004", "F006"],
    "P4_S003": ["F001", "F004", "F006", "F010", "F012"],
    "P4_S004": ["F001", "F004", "F006", "F012"],
    "P4_S005": ["F001", "F004", "F006", "F012"],
    "P4_S006": ["F001", "F004", "F006", "F007", "F012"],
    "P4_S007": ["F001", "F004", "F006", "F009", "F012"],
    "P4_S008": ["F001", "F004", "F006", "F012"],
    "P4_S009": ["F001", "F004", "F006", "F008", "F012"],
    "P4_S010": ["F001", "F003", "F004", "F006", "F012"],
    "P5_S001": ["F001", "F004", "F010"],
    "P5_S002": ["F001", "F004"],
    "P5_S003": ["F001", "F004", "F008"],
    "P5_S004": ["F001", "F004", "F008"],
    "P5_S005": ["F001", "F004"],
    "P5_S006": ["F001", "F004"],
    "P5_S007": ["F001", "F004"],
    "P5_S008": ["F001", "F004"],
    "P5_S009": ["F001", "F004", "F006"],
    "P5_S010": ["F001", "F004"],
    "P5_S011": ["F001", "F004"],
    "P5_S012": ["F001", "F004"],
    "P5_S013": ["F001", "F004", "F009"],
    "P5_S014": ["F001", "F004"],
    "P5_S015": ["F001", "F004"],
    "G002": ["F001"],
    "G003": ["F001", "F002", "F003"]
  },
  "usage_examples": {
    "scenario_1": {
      "question": "如果我要修改Git Hooks功能，需要关注哪些验证步骤？",
      "answer": "需要关注 F002 Git Hooks Integration，涉及步骤: P2_S009, P2_S010, P3_S012, G003",
      "impact": "影响提交流程，需验证所有git操作"
    },
    "scenario_2": {
      "question": "P3_S012失败了，这会影响哪些功能？",
      "answer": "影响 F001 (Workflow Validation), F002 (Git Hooks), F003 (Branch Protection), F004 (Phase System), F006 (Quality Gates), F011 (Static Checks)",
      "action": "检查Git hooks语法和执行权限"
    },
    "scenario_3": {
      "question": "我想优化Quality Gates功能，涉及哪些步骤？",
      "answer": "F006 Quality Gate System涉及所有P3步骤(S001-S015)、所有P4步骤(S001-S010)和P5_S009",
      "complexity": "高复杂度，需要完整测试验证"
    }
  }
}
