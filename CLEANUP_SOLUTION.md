# Claude Enhancer æ™ºèƒ½æ¸…ç†ç³»ç»Ÿæ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜è¯Šæ–­

### å½“å‰çŠ¶å†µ
- **æ–‡ä»¶çˆ†ç‚¸**ï¼šä»Šå¤©åˆ›å»ºäº†1085ä¸ªæ–‡ä»¶
- **ç¼ºä¹ç®¡ç†**ï¼šè™½æœ‰æ¸…ç†è„šæœ¬ä½†æœªèå…¥å·¥ä½œæµ
- **åƒåœ¾å †ç§¯**ï¼šæµ‹è¯•æ–‡ä»¶ã€ä¸´æ—¶æ–‡ä»¶ã€å¤‡ä»½æ–‡ä»¶æ··æ‚

### æ ¹æœ¬åŸå› 
1. Claude Codeåˆ›å»ºæ–‡ä»¶è¿‡å¤šï¼Œç¼ºä¹èŠ‚åˆ¶
2. æ¸…ç†ç³»ç»Ÿä¸Claude Enhancerå·¥ä½œæµè„±èŠ‚
3. æ²¡æœ‰è‡ªåŠ¨è§¦å‘æœºåˆ¶ï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ

## ğŸ—ï¸ è§£å†³æ–¹æ¡ˆæ¶æ„

### 1. ä¸‰å±‚æ¸…ç†ä½“ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å®æ—¶å±‚ (Real-time)                 â”‚
â”‚   Claude Hooks - æ–‡ä»¶åˆ›å»ºæ—¶å³æ—¶æ£€æŸ¥         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æ‰¹å¤„ç†å±‚ (Batch)                    â”‚
â”‚   Phaseåˆ‡æ¢æ—¶è‡ªåŠ¨æ¸…ç† (P3/P5/P6)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          å®šæ—¶å±‚ (Scheduled)                  â”‚
â”‚   æ¯å¤©å‡Œæ™¨æ·±åº¦æ¸…ç† (cron)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. é›†æˆç‚¹è®¾è®¡

#### A. Hookçº§åˆ«é›†æˆ
```bash
# .claude/hooks/file_guard.sh
# åœ¨æ–‡ä»¶æ“ä½œå‰åè‡ªåŠ¨è§¦å‘

- pre-write: æ£€æŸ¥æ˜¯å¦é‡å¤æ–‡ä»¶
- post-write: ç»Ÿè®¡æ–°å¢æ–‡ä»¶
- threshold: è¶…è¿‡é˜ˆå€¼è§¦å‘æ¸…ç†
```

#### B. Phaseçº§åˆ«é›†æˆ
```python
# å·¥ä½œæµPhaseä¸æ¸…ç†ç­–ç•¥æ˜ å°„
phase_cleanup_map = {
    "P0": None,           # æ¢ç´¢é˜¶æ®µä¸æ¸…ç†
    "P1": "light",        # è½»åº¦æ¸…ç†
    "P2": "light",        # è½»åº¦æ¸…ç†
    "P3": "test_files",   # æ¸…ç†æµ‹è¯•åƒåœ¾
    "P4": "test_output",  # æ¸…ç†æµ‹è¯•è¾“å‡º
    "P5": "backup_files", # æ¸…ç†å¤‡ä»½æ–‡ä»¶
    "P6": "deep",         # æ·±åº¦æ¸…ç†
    "P7": None            # ç›‘æ§é˜¶æ®µä¸æ¸…ç†
}
```

#### C. Agentçº§åˆ«é›†æˆ
```yaml
# Taskå®Œæˆåè‡ªåŠ¨æ¸…ç†
agent_cleanup_rules:
  test-engineer:
    - pattern: "test_*.tmp"
    - pattern: "*_test_output.*"
  code-reviewer:
    - pattern: "*.review.tmp"
  backend-architect:
    - pattern: "*.diagram.tmp"
```

### 3. æ¸…ç†è§„åˆ™åˆ†çº§

#### Level 1: å®‰å…¨æ¸…ç†ï¼ˆæ— é£é™©ï¼‰
```
æ–‡ä»¶ç±»å‹ï¼š*.pyc, *.pyo, *~, .DS_Store, Thumbs.db
è§¦å‘æ—¶æœºï¼šéšæ—¶å¯æ‰§è¡Œ
è‡ªåŠ¨æ‰§è¡Œï¼šæ˜¯
```

#### Level 2: ä¸´æ—¶æ–‡ä»¶ï¼ˆä½é£é™©ï¼‰
```
æ–‡ä»¶ç±»å‹ï¼š*.tmp, *.temp, *.swp, test_*.tmp
è§¦å‘æ—¶æœºï¼šPhaseå®Œæˆå
è‡ªåŠ¨æ‰§è¡Œï¼šæ˜¯ï¼ˆéœ€ç¡®è®¤æ•°é‡ï¼‰
```

#### Level 3: å†—ä½™æ–‡ä»¶ï¼ˆä¸­é£é™©ï¼‰
```
æ–‡ä»¶ç±»å‹ï¼š*_copy.*, *(1).*, *_backup.*
è§¦å‘æ—¶æœºï¼šP5å®¡æŸ¥å
è‡ªåŠ¨æ‰§è¡Œï¼šéœ€è¦ç¡®è®¤
```

#### Level 4: æ·±åº¦æ¸…ç†ï¼ˆé«˜é£é™©ï¼‰
```
æ–‡ä»¶ç±»å‹ï¼šæ—§æ—¥å¿—ã€å¤§æ–‡ä»¶ã€é‡å¤ä»£ç 
è§¦å‘æ—¶æœºï¼šP6å‘å¸ƒå‰
è‡ªåŠ¨æ‰§è¡Œï¼šå¦ï¼ˆéœ€äººå·¥ç¡®è®¤ï¼‰
```

## ğŸ’¡ å®æ–½æ–¹æ¡ˆ

### Step 1: åˆ›å»ºæ ¸å¿ƒæ¨¡å—
```python
# .claude/core/smart_cleanup.py
class SmartCleanup:
    def __init__(self):
        self.phase_rules = {...}
        self.cleanup_levels = {...}

    def should_cleanup(self) -> bool
    def cleanup_by_phase(self, phase: str)
    def cleanup_by_level(self, level: int)
    def smart_cleanup(self, dry_run: bool)
```

### Step 2: å‡çº§Hookç³»ç»Ÿ
```bash
# .claude/hooks/auto_cleanup.sh
#!/bin/bash
# ç›‘æ§æ–‡ä»¶åˆ›å»ºï¼Œè¶…é˜ˆå€¼è‡ªåŠ¨æ¸…ç†

NEW_FILES=$(find . -mmin -60 | wc -l)
if [ "$NEW_FILES" -gt 50 ]; then
    python3 .claude/core/smart_cleanup.py --level 1
fi
```

### Step 3: ä¿®æ”¹å·¥ä½œæµ
```bash
# .workflow/ticket_manager.sh
# åœ¨Phaseåˆ‡æ¢æ—¶è§¦å‘æ¸…ç†

switch_phase() {
    old_phase=$1
    new_phase=$2

    # Phaseåˆ‡æ¢æ—¶æ¸…ç†
    if [[ "$old_phase" == "P3" ]] || \
       [[ "$old_phase" == "P5" ]] || \
       [[ "$old_phase" == "P6" ]]; then
        python3 .claude/core/smart_cleanup.py \
            --phase "$old_phase"
    fi
}
```

### Step 4: æ·»åŠ è´¨é‡é—¨ç¦
```yaml
# .github/workflows/ci-enhanced.yml
- name: Check File Hygiene
  run: |
    python3 .claude/core/smart_cleanup.py --check
    if [ $? -ne 0 ]; then
      echo "Too many junk files detected!"
      exit 1
    fi
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. è‡ªåŠ¨æ¨¡å¼ï¼ˆæ¨èï¼‰
```bash
# å®‰è£…åè‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€å¹²é¢„
./.claude/install.sh --enable-cleanup
```

### 2. æ‰‹åŠ¨è§¦å‘
```bash
# æ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…ç†
python3 .claude/core/smart_cleanup.py --check

# é¢„è§ˆæ¸…ç†ï¼ˆä¸å®é™…åˆ é™¤ï¼‰
python3 .claude/core/smart_cleanup.py --dry-run

# æ‰§è¡Œæ¸…ç†
python3 .claude/core/smart_cleanup.py

# æ¿€è¿›æ¸…ç†ï¼ˆLevel 3-4ï¼‰
python3 .claude/core/smart_cleanup.py --aggressive
```

### 3. Phaseè§¦å‘
```bash
# å®ŒæˆP3å®ç°å
.workflow/ticket_manager.sh complete P3
# è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ–‡ä»¶

# å®ŒæˆP5å®¡æŸ¥å
.workflow/ticket_manager.sh complete P5
# è‡ªåŠ¨æ¸…ç†å¤‡ä»½æ–‡ä»¶
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

### æ¸…ç†å‰
```
é¡¹ç›®æ–‡ä»¶æ•°ï¼š2500+
åƒåœ¾æ–‡ä»¶ï¼š500+
å ç”¨ç©ºé—´ï¼š200MBåƒåœ¾
```

### æ¸…ç†å
```
é¡¹ç›®æ–‡ä»¶æ•°ï¼š1000-1500
åƒåœ¾æ–‡ä»¶ï¼š<50
é‡Šæ”¾ç©ºé—´ï¼š180MB+
```

### æ•ˆæœæŒ‡æ ‡
- **æ–‡ä»¶å‡å°‘**ï¼š40-60%
- **ç©ºé—´é‡Šæ”¾**ï¼š90%åƒåœ¾ç©ºé—´
- **æ€§èƒ½æå‡**ï¼šGitæ“ä½œå¿«30%
- **å¼€å‘ä½“éªŒ**ï¼šæ›´æ¸…çˆ½çš„é¡¹ç›®ç»“æ„

## ğŸ”§ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡
```bash
# è®¾ç½®æ¸…ç†çº§åˆ«
export CLEANUP_LEVEL=2  # 1-4

# è®¾ç½®è‡ªåŠ¨æ¸…ç†é˜ˆå€¼
export CLEANUP_THRESHOLD=100  # æ–‡ä»¶æ•°

# ç¦ç”¨è‡ªåŠ¨æ¸…ç†
export DISABLE_AUTO_CLEANUP=1
```

### é…ç½®æ–‡ä»¶
```yaml
# .claude/cleanup.yml
auto_cleanup:
  enabled: true
  threshold: 100
  max_level: 2

protected_dirs:
  - .git
  - .claude
  - node_modules

custom_rules:
  - pattern: "*.custom"
    level: 1
```

## âš¡ å¿«é€Ÿå¼€å§‹

```bash
# 1. æŸ¥çœ‹å½“å‰çŠ¶æ€
find . -type f -mtime -1 | wc -l  # ä»Šå¤©åˆ›å»ºçš„æ–‡ä»¶æ•°

# 2. è¿è¡Œæ¸…ç†æ£€æŸ¥
python3 .claude/core/smart_cleanup.py --check

# 3. é¢„è§ˆæ¸…ç†æ•ˆæœ
python3 .claude/core/smart_cleanup.py --dry-run

# 4. æ‰§è¡Œæ¸…ç†
python3 .claude/core/smart_cleanup.py

# 5. è®¾ç½®è‡ªåŠ¨æ¸…ç†
echo "export AUTO_CLEANUP=1" >> ~/.bashrc
```

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

1. **èå…¥å·¥ä½œæµ**ï¼šä¸æ˜¯ç‹¬ç«‹å·¥å…·ï¼Œæ˜¯Claude Enhancerçš„æœ‰æœºç»„æˆ
2. **æ™ºèƒ½åˆ†çº§**ï¼š4çº§æ¸…ç†ç­–ç•¥ï¼Œå®‰å…¨å¯æ§
3. **è‡ªåŠ¨è§¦å‘**ï¼šPhaseåˆ‡æ¢ã€æ–‡ä»¶é˜ˆå€¼ã€å®šæ—¶ä»»åŠ¡
4. **å¯è¿½æº¯**ï¼šå®Œæ•´çš„æ¸…ç†æ—¥å¿—ï¼Œå¯å›æ»š
5. **é›¶é…ç½®**ï¼šå¼€ç®±å³ç”¨ï¼Œæ™ºèƒ½åˆ¤æ–­

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡è¿è¡Œ**å»ºè®®ç”¨`--dry-run`é¢„è§ˆ
2. **é‡è¦é¡¹ç›®**è¯·å…ˆå¤‡ä»½
3. **ä¿æŠ¤ç›®å½•**æ°¸è¿œä¸ä¼šè¢«æ¸…ç†
4. **æ¸…ç†æ—¥å¿—**ä¿å­˜åœ¨`.cleanup_log`
5. **å¯ä»¥å›æ»š**ï¼šæ¸…ç†çš„æ–‡ä»¶å…ˆç§»åˆ°`.trash`ï¼ˆå¯é€‰ï¼‰

---

è¿™ä¸ªæ–¹æ¡ˆå®Œå…¨èå…¥Claude Enhancerä½“ç³»ï¼Œä¸æ˜¯ç‹¬ç«‹å·¥å…·è€Œæ˜¯å·¥ä½œæµçš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡Hookã€Phaseã€Agentä¸‰ä¸ªå±‚é¢çš„é›†æˆï¼Œå®ç°è‡ªåŠ¨åŒ–çš„æ–‡ä»¶ç®¡ç†ã€‚