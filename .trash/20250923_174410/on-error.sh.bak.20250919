#!/bin/bash
# Claude Code On-error Hook - é”™è¯¯æ—¶çš„å¤„ç†

echo "âŒ æ£€æµ‹åˆ°é”™è¯¯ï¼Œæ‰§è¡ŒClaude Enhanceré”™è¯¯å¤„ç†..."

# è®°å½•é”™è¯¯å¹¶æä¾›ä¿®å¤å»ºè®®
python3 -c "
import sys
import json
from datetime import datetime
sys.path.insert(0, '/home/xx/dev/Claude Enhancer')

error_msg = '''$1'''

# åˆ†æé”™è¯¯ç±»å‹
if 'agent' in error_msg.lower() or 'task' in error_msg.lower():
    print('ğŸ’¡ Claude Enhancerå»ºè®®ï¼š')
    print('  1. æ£€æŸ¥Agenté€‰æ‹©æ˜¯å¦æ­£ç¡®ï¼ˆè‡³å°‘3ä¸ªï¼‰')
    print('  2. ç¡®è®¤ä½¿ç”¨å¹¶è¡Œæ‰§è¡Œæ¨¡å¼')
    print('  3. éªŒè¯Agentç»„åˆæ˜¯å¦åŒ¹é…ä»»åŠ¡ç±»å‹')
elif 'test' in error_msg.lower() or 'fail' in error_msg.lower():
    print('ğŸ’¡ Claude Enhancerå»ºè®®ï¼š')
    print('  1. è§¦å‘åé¦ˆå¾ªç¯æœºåˆ¶')
    print('  2. è®©åŸAgentä¿®å¤ä»£ç ')
    print('  3. ä¸è¦è·³è¿‡æµ‹è¯•ç›´æ¥æäº¤')
elif 'commit' in error_msg.lower():
    print('ğŸ’¡ Claude Enhancerå»ºè®®ï¼š')
    print('  1. æ£€æŸ¥æäº¤æ¶ˆæ¯æ ¼å¼ï¼ˆfeat:/fix:/docs:ç­‰ï¼‰')
    print('  2. ç¡®ä¿æµ‹è¯•é€šè¿‡')
    print('  3. è¿è¡Œè´¨é‡æ£€æŸ¥')

# è®°å½•åˆ°æ—¥å¿—
log_path = '/home/xx/dev/Claude Enhancer/.perfect21/error.log'
with open(log_path, 'a') as f:
    f.write(f'[{datetime.now().isoformat()}] {error_msg}\\n')
"

exit 0