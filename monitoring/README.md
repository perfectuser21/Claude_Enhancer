# Claude Enhancer 5.1 ç›‘æ§ç³»ç»Ÿ

> ğŸ” ä¼ä¸šçº§å…¨é¢ç›‘æ§è§£å†³æ–¹æ¡ˆï¼šæ€§èƒ½æŒ‡æ ‡ã€æ—¥å¿—èšåˆã€å®æ—¶å‘Šè­¦ã€SLAç›‘æ§ã€å¼‚å¸¸æ£€æµ‹

## ğŸ“‹ ç›‘æ§ç³»ç»Ÿæ¦‚è§ˆ

### ğŸ¯ æ ¸å¿ƒç›®æ ‡
- **å¯è§‚æµ‹æ€§ä¸‰æ”¯æŸ±**: æŒ‡æ ‡(Metrics) + æ—¥å¿—(Logs) + é“¾è·¯è¿½è¸ª(Traces)
- **SLAä¿éšœ**: 99.9%å¯ç”¨æ€§ï¼Œ200mså“åº”æ—¶é—´ï¼Œ0.1%é”™è¯¯ç‡
- **ä¸»åŠ¨ç›‘æ§**: å®æ—¶å‘Šè­¦ï¼Œå¼‚å¸¸æ£€æµ‹ï¼Œè¶‹åŠ¿åˆ†æ
- **è¿ç»´å‹å¥½**: è‡ªåŠ¨åŒ–è¿ç»´ï¼Œå¯è§†åŒ–ä»ªè¡¨æ¿ï¼Œæ™ºèƒ½è¯Šæ–­

### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Enhancer 5.1                     â”‚
â”‚                      ç›‘æ§ç³»ç»Ÿæ¶æ„                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨æœåŠ¡å±‚    â”‚    â”‚   ä¸­é—´ä»¶å±‚      â”‚    â”‚   åŸºç¡€è®¾æ–½å±‚    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Auth Service  â”‚    â”‚ â€¢ Load Balancer â”‚    â”‚ â€¢ CPU/Memory    â”‚
â”‚ â€¢ API Gateway   â”‚    â”‚ â€¢ Cache (Redis) â”‚    â”‚ â€¢ Disk/Network  â”‚
â”‚ â€¢ Dashboard     â”‚    â”‚ â€¢ Database      â”‚    â”‚ â€¢ System Metricsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚                       â”‚
        â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç›‘æ§æ•°æ®æ”¶é›†å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¤
â”‚ MetricsCollectorâ”‚ LogsAggregator  â”‚ TracingCollectorâ”‚ ...  â”‚
â”‚                 â”‚                 â”‚                 â”‚      â”‚
â”‚ â€¢ æŒ‡æ ‡æ”¶é›†      â”‚ â€¢ æ—¥å¿—èšåˆ      â”‚ â€¢ é“¾è·¯è¿½è¸ª      â”‚      â”‚
â”‚ â€¢ å‘Šè­¦è§„åˆ™      â”‚ â€¢ ç»“æ„åŒ–å­˜å‚¨    â”‚ â€¢ æ€§èƒ½åˆ†æ      â”‚      â”‚
â”‚ â€¢ æ•°æ®å¯¼å‡º      â”‚ â€¢ æœç´¢åˆ†æ      â”‚ â€¢ ä¾èµ–å…³ç³»      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å­˜å‚¨ä¸å¤„ç†å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¤
â”‚   Prometheus    â”‚  Elasticsearch  â”‚     Jaeger      â”‚ ...  â”‚
â”‚                 â”‚                 â”‚                 â”‚      â”‚
â”‚ â€¢ æ—¶åºæ•°æ®åº“    â”‚ â€¢ æ—¥å¿—å­˜å‚¨      â”‚ â€¢ è¿½è¸ªå­˜å‚¨      â”‚      â”‚
â”‚ â€¢ æŸ¥è¯¢è¯­è¨€      â”‚ â€¢ å…¨æ–‡æœç´¢      â”‚ â€¢ åˆ†æå¯è§†åŒ–    â”‚      â”‚
â”‚ â€¢ å‘Šè­¦è§„åˆ™      â”‚ â€¢ ç´¢å¼•ç®¡ç†      â”‚ â€¢ æ€§èƒ½ä¼˜åŒ–      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç›‘æ§åˆ†æä¸å‘Šè­¦å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¤
â”‚  SLAç›‘æ§        â”‚  å¼‚å¸¸æ£€æµ‹       â”‚  æ™ºèƒ½å‘Šè­¦       â”‚ ...  â”‚
â”‚                 â”‚                 â”‚                 â”‚      â”‚
â”‚ â€¢ å¯ç”¨æ€§è®¡ç®—    â”‚ â€¢ ç»Ÿè®¡åˆ†æ      â”‚ â€¢ å‘Šè­¦èšåˆ      â”‚      â”‚
â”‚ â€¢ æ€§èƒ½åŸºå‡†      â”‚ â€¢ è¶‹åŠ¿è¯†åˆ«      â”‚ â€¢ é€šçŸ¥è·¯ç”±      â”‚      â”‚
â”‚ â€¢ åˆè§„æŠ¥å‘Š      â”‚ â€¢ é¢„æµ‹åˆ†æ      â”‚ â€¢ é¢‘ç‡æ§åˆ¶      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¯è§†åŒ–ä¸é€šçŸ¥å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¤
â”‚   Grafana       â”‚   Web Dashboard â”‚   é€šçŸ¥ç³»ç»Ÿ      â”‚ ...  â”‚
â”‚                 â”‚                 â”‚                 â”‚      â”‚
â”‚ â€¢ ä¸“ä¸šå›¾è¡¨      â”‚ â€¢ å®æ—¶ç›‘æ§      â”‚ â€¢ Slacké›†æˆ     â”‚      â”‚
â”‚ â€¢ å¤šç»´åˆ†æ      â”‚ â€¢ ç§»åŠ¨ç«¯æ”¯æŒ    â”‚ â€¢ é‚®ä»¶å‘Šè­¦      â”‚      â”‚
â”‚ â€¢ è‡ªå®šä¹‰é¢æ¿    â”‚ â€¢ æƒé™æ§åˆ¶      â”‚ â€¢ PagerDuty     â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚
```bash
# Pythonç¯å¢ƒ
Python >= 3.8

# ä¾èµ–åŒ…
pip install aiohttp pyyaml psutil aiofiles

# å¯é€‰ï¼šDockerç¯å¢ƒï¼ˆç”¨äºPrometheusã€Grafanaç­‰ï¼‰
Docker >= 20.0
Docker Compose >= 2.0
```

### 2. é…ç½®æ–‡ä»¶
```bash
# ä¸»è¦é…ç½®é¡¹
vim monitoring/monitoring_config.yaml
```

### 3. å¯åŠ¨ç›‘æ§ç³»ç»Ÿ
```python
import asyncio
from monitoring.monitoring_integration import create_monitoring_system

async def main():
    # åˆ›å»ºç›‘æ§ç³»ç»Ÿ
    monitoring = await create_monitoring_system("monitoring/monitoring_config.yaml")

    # ç³»ç»Ÿä¼šè‡ªåŠ¨å¼€å§‹æ”¶é›†æŒ‡æ ‡ã€æ£€æŸ¥å¥åº·çŠ¶æ€ã€å‘é€å‘Šè­¦
    print("ğŸ¯ ç›‘æ§ç³»ç»Ÿå·²å¯åŠ¨ï¼Œè®¿é—® http://localhost:8080 æŸ¥çœ‹ä»ªè¡¨æ¿")

    # ä¿æŒè¿è¡Œ
    try:
        while True:
            await asyncio.sleep(60)
            summary = await monitoring.get_monitoring_summary()
            print(f"ğŸ“Š ç›‘æ§æ‘˜è¦: {summary['metrics_collector']['total_metrics_collected']}ä¸ªæŒ‡æ ‡")
    except KeyboardInterrupt:
        await monitoring.shutdown()

if __name__ == "__main__":
    asyncio.run(main())
```

### 4. æŸ¥çœ‹ç›‘æ§æ•°æ®
- **Webä»ªè¡¨æ¿**: http://localhost:8080
- **Prometheus**: http://localhost:9090 (éœ€è¦å•ç‹¬å¯åŠ¨)
- **Grafana**: http://localhost:3000 (éœ€è¦å•ç‹¬å¯åŠ¨)

## ğŸ“Š ç›‘æ§æŒ‡æ ‡è¯¦è§£

### ğŸ¯ ä¸šåŠ¡æŒ‡æ ‡ (Business Metrics)
```yaml
è®¤è¯ç›¸å…³:
  - auth_requests_total: è®¤è¯è¯·æ±‚æ€»æ•° [Counter]
  - auth_response_time: è®¤è¯å“åº”æ—¶é—´ [Histogram]
  - user_sessions_active: æ´»è·ƒç”¨æˆ·ä¼šè¯ [Gauge]
  - password_strength_score: å¯†ç å¼ºåº¦åˆ†å¸ƒ [Histogram]
  - mfa_success_rate: MFAæˆåŠŸç‡ [Gauge]

ç”¨æˆ·è¡Œä¸º:
  - user_registrations_total: ç”¨æˆ·æ³¨å†Œæ€»æ•° [Counter]
  - login_failures_total: ç™»å½•å¤±è´¥æ¬¡æ•° [Counter]
  - session_duration: ä¼šè¯æŒç»­æ—¶é—´ [Histogram]
```

### âš™ï¸ ç³»ç»ŸæŒ‡æ ‡ (System Metrics)
```yaml
èµ„æºä½¿ç”¨:
  - claude_enhancer_cpu_usage: CPUä½¿ç”¨ç‡ [Gauge]
  - claude_enhancer_memory_usage: å†…å­˜ä½¿ç”¨ç‡ [Gauge]
  - claude_enhancer_disk_usage: ç£ç›˜ä½¿ç”¨ç‡ [Gauge]
  - network_bytes_sent/recv: ç½‘ç»œæµé‡ [Counter]

è¿›ç¨‹æŒ‡æ ‡:
  - process_memory_rss: è¿›ç¨‹å†…å­˜ [Gauge]
  - process_cpu_percent: è¿›ç¨‹CPU [Gauge]
  - process_threads: çº¿ç¨‹æ•° [Gauge]
  - process_open_fds: æ–‡ä»¶æè¿°ç¬¦ [Gauge]
```

### ğŸš€ æ€§èƒ½æŒ‡æ ‡ (Performance Metrics)
```yaml
å“åº”æ€§èƒ½:
  - request_duration_seconds: è¯·æ±‚å¤„ç†æ—¶é—´ [Histogram]
  - queue_size: é˜Ÿåˆ—å¤§å° [Gauge]
  - active_workers: æ´»è·ƒå·¥ä½œçº¿ç¨‹ [Gauge]
  - completed_tasks: å®Œæˆä»»åŠ¡æ•° [Counter]

æ•°æ®åº“æ€§èƒ½:
  - database_connections: æ•°æ®åº“è¿æ¥æ•° [Gauge]
  - database_query_duration: æŸ¥è¯¢æ—¶é—´ [Histogram]
  - database_slow_queries: æ…¢æŸ¥è¯¢æ•° [Counter]

ç¼“å­˜æ€§èƒ½:
  - cache_hit_ratio: ç¼“å­˜å‘½ä¸­ç‡ [Gauge]
  - cache_size: ç¼“å­˜å¤§å° [Gauge]
  - cache_operations_total: ç¼“å­˜æ“ä½œ [Counter]
```

## ğŸš¨ å‘Šè­¦è§„åˆ™è¯¦è§£

### ğŸ’¥ å¯ç”¨æ€§å‘Šè­¦
```yaml
ServiceDown:
  æ¡ä»¶: up == 0
  æŒç»­æ—¶é—´: 2åˆ†é’Ÿ
  çº§åˆ«: critical
  è¯´æ˜: æœåŠ¡å®Œå…¨ä¸å¯ç”¨

HighErrorRate:
  æ¡ä»¶: é”™è¯¯ç‡ > 5%
  æŒç»­æ—¶é—´: 5åˆ†é’Ÿ
  çº§åˆ«: warning
  è¯´æ˜: é”™è¯¯ç‡å¼‚å¸¸å¢é«˜

AuthServiceUnavailable:
  æ¡ä»¶: è®¤è¯æˆåŠŸç‡ < 90%
  æŒç»­æ—¶é—´: 3åˆ†é’Ÿ
  çº§åˆ«: critical
  è¯´æ˜: è®¤è¯æœåŠ¡ä¸¥é‡æ•…éšœ
```

### âš¡ æ€§èƒ½å‘Šè­¦
```yaml
HighResponseTime:
  æ¡ä»¶: P95å“åº”æ—¶é—´ > 1ç§’
  æŒç»­æ—¶é—´: 10åˆ†é’Ÿ
  çº§åˆ«: warning
  è¯´æ˜: å“åº”æ—¶é—´æ˜¾è‘—å¢åŠ 

CriticalResponseTime:
  æ¡ä»¶: P95å“åº”æ—¶é—´ > 5ç§’
  æŒç»­æ—¶é—´: 5åˆ†é’Ÿ
  çº§åˆ«: critical
  è¯´æ˜: å“åº”æ—¶é—´è¾¾åˆ°å±é™©æ°´å¹³

QueueBacklog:
  æ¡ä»¶: é˜Ÿåˆ—å¤§å° > 1000
  æŒç»­æ—¶é—´: 5åˆ†é’Ÿ
  çº§åˆ«: error
  è¯´æ˜: ä»»åŠ¡é˜Ÿåˆ—ç§¯å‹ä¸¥é‡
```

### ğŸ’» èµ„æºå‘Šè­¦
```yaml
HighCpuUsage:
  æ¡ä»¶: CPUä½¿ç”¨ç‡ > 80%
  æŒç»­æ—¶é—´: 15åˆ†é’Ÿ
  çº§åˆ«: warning

CriticalMemoryUsage:
  æ¡ä»¶: å†…å­˜ä½¿ç”¨ç‡ > 95%
  æŒç»­æ—¶é—´: 5åˆ†é’Ÿ
  çº§åˆ«: critical

LowDiskSpace:
  æ¡ä»¶: ç£ç›˜ä½¿ç”¨ç‡ > 85%
  æŒç»­æ—¶é—´: 30åˆ†é’Ÿ
  çº§åˆ«: warning
```

### ğŸ”’ å®‰å…¨å‘Šè­¦
```yaml
SuspiciousAuthFailures:
  æ¡ä»¶: è®¤è¯å¤±è´¥ç‡ > 10æ¬¡/ç§’
  æŒç»­æ—¶é—´: 2åˆ†é’Ÿ
  çº§åˆ«: warning
  è¯´æ˜: å¯èƒ½çš„æš´åŠ›ç ´è§£æ”»å‡»

MassiveAuthFailures:
  æ¡ä»¶: è®¤è¯å¤±è´¥ç‡ > 50æ¬¡/ç§’
  æŒç»­æ—¶é—´: 1åˆ†é’Ÿ
  çº§åˆ«: critical
  è¯´æ˜: å¤§è§„æ¨¡æ”»å‡»æ£€æµ‹
```

## ğŸ“ˆ SLAç›‘æ§

### ğŸ¯ SLAç›®æ ‡
```yaml
å¯ç”¨æ€§SLA:
  ç›®æ ‡: 99.9%
  è®¡ç®—å‘¨æœŸ: 30å¤©
  å…è®¸åœæœº: 43.2åˆ†é’Ÿ/æœˆ

å“åº”æ—¶é—´SLA:
  ç›®æ ‡: 200ms (P95)
  è®¡ç®—å‘¨æœŸ: 7å¤©
  ç›‘æ§é¢‘ç‡: å®æ—¶

é”™è¯¯ç‡SLA:
  ç›®æ ‡: < 0.1%
  è®¡ç®—å‘¨æœŸ: 24å°æ—¶
  è§¦å‘é˜ˆå€¼: è¿ç»­30åˆ†é’Ÿè¿è§„
```

### ğŸ“Š SLIè®¡ç®—
```promql
# å¯ç”¨æ€§SLI
(sum(up{job=~"claude-enhancer.*"}) / count(up{job=~"claude-enhancer.*"})) * 100

# å»¶è¿ŸSLI
histogram_quantile(0.95, sum(rate(auth_response_time_bucket[5m])))

# é”™è¯¯ç‡SLI
(sum(rate(auth_requests_total{status=~"5.."}[5m])) / sum(rate(auth_requests_total[5m]))) * 100
```

## ğŸ” å¼‚å¸¸æ£€æµ‹

### ğŸ“Š ç»Ÿè®¡æ–¹æ³•
```python
# Z-Scoreå¼‚å¸¸æ£€æµ‹
def detect_anomaly_zscore(values, threshold=3.0):
    mean = sum(values) / len(values)
    std_dev = (sum((x - mean)**2 for x in values) / len(values))**0.5

    for value in values:
        z_score = abs(value - mean) / std_dev
        if z_score > threshold:
            return True  # å¼‚å¸¸
    return False
```

### ğŸ“ˆ è¶‹åŠ¿åˆ†æ
```python
# è¶‹åŠ¿å˜åŒ–æ£€æµ‹
def detect_trend_change(values, window_size=10, threshold=0.5):
    before_avg = sum(values[:window_size]) / window_size
    after_avg = sum(values[window_size:]) / window_size

    change_ratio = abs(after_avg - before_avg) / before_avg
    return change_ratio > threshold
```

## ğŸ”” é€šçŸ¥ç³»ç»Ÿ

### ğŸ“± Slacké›†æˆ
```python
# Slack Webhooké…ç½®
SLACK_WEBHOOK_URL = "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"

# å‘Šè­¦æ¶ˆæ¯æ¨¡æ¿
{
    "text": "ğŸš¨ Claude Enhancer 5.1 Alert",
    "attachments": [
        {
            "color": "danger",  # danger, warning, good
            "fields": [
                {"title": "Alert", "value": "HighErrorRate", "short": True},
                {"title": "Severity", "value": "critical", "short": True},
                {"title": "Message", "value": "é”™è¯¯ç‡è¾¾åˆ°8.5%", "short": False}
            ]
        }
    ]
}
```

### ğŸ“§ é‚®ä»¶å‘Šè­¦
```python
# SMTPé…ç½®
SMTP_CONFIG = {
    'server': 'smtp.gmail.com',
    'port': 587,
    'username': 'your-email@gmail.com',
    'password': 'your-app-password',
    'use_tls': True
}

# æ”¶ä»¶äººé…ç½®
RECIPIENTS = {
    'critical': ['oncall@company.com', 'tech-lead@company.com'],
    'error': ['dev-team@company.com'],
    'warning': ['monitoring@company.com']
}
```

### ğŸ”” é€šçŸ¥é¢‘ç‡æ§åˆ¶
```python
# å‘Šè­¦æŠ‘åˆ¶é…ç½®
ALERT_COOLDOWN = {
    'critical': 60,    # 1åˆ†é’Ÿ
    'error': 300,      # 5åˆ†é’Ÿ
    'warning': 900,    # 15åˆ†é’Ÿ
    'info': 3600       # 1å°æ—¶
}
```

## ğŸ¨ å¯è§†åŒ–ä»ªè¡¨æ¿

### ğŸ“Š Grafanaé…ç½®
```json
{
  "dashboard": {
    "title": "Claude Enhancer 5.1 - ä¼ä¸šçº§ç›‘æ§",
    "panels": [
      {
        "title": "ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ",
        "type": "stat",
        "targets": [{"expr": "up{job=~\"claude-enhancer.*\"}"}]
      },
      {
        "title": "è¯·æ±‚é€Ÿç‡ (RPS)",
        "type": "graph",
        "targets": [{"expr": "sum(rate(auth_requests_total[5m])) by (service)"}]
      }
    ]
  }
}
```

### ğŸŒ Webä»ªè¡¨æ¿
- **å®æ—¶æ›´æ–°**: WebSocketæ¨é€
- **å“åº”å¼è®¾è®¡**: æ”¯æŒç§»åŠ¨ç«¯
- **äº¤äº’å¼å›¾è¡¨**: ç‚¹å‡»é’»å–
- **è‡ªå®šä¹‰æ—¶é—´èŒƒå›´**: çµæ´»æŸ¥è¯¢

### ğŸ“± ç§»åŠ¨ç«¯æ”¯æŒ
- é€‚é…æ‰‹æœºå±å¹•
- è§¦æ‘¸å‹å¥½ç•Œé¢
- ç¦»çº¿æ•°æ®ç¼“å­˜
- æ¨é€é€šçŸ¥æ”¯æŒ

## ğŸ”§ é…ç½®ç®¡ç†

### ğŸ“ ä¸»é…ç½®æ–‡ä»¶
```yaml
# monitoring_config.yaml
monitoring:
  service_name: "claude-enhancer-5.1"
  environment: "production"

  metrics:
    collection_interval: 10
    retention_period: "7d"

  alerts:
    availability:
      - name: "service_down"
        condition: "== 0"
        duration: "2m"
        severity: "critical"
```

### ğŸ›ï¸ ç¯å¢ƒå˜é‡
```bash
# å¿…éœ€çš„ç¯å¢ƒå˜é‡
export ENVIRONMENT=production
export DATABASE_URL=postgresql://user:pass@localhost:5432/db
export REDIS_URL=redis://localhost:6379/0
export SLACK_WEBHOOK_URL=https://hooks.slack.com/...

# å¯é€‰çš„ç¯å¢ƒå˜é‡
export PROMETHEUS_PORT=9090
export GRAFANA_PORT=3000
export ALERT_COOLDOWN=300
```

## ğŸƒ è¿ç»´æ‰‹å†Œ

### ğŸš€ éƒ¨ç½²æµç¨‹
```bash
# 1. è¿›å…¥ç›‘æ§ç›®å½•
cd monitoring/

# 2. å®‰è£…ä¾èµ–
pip install aiohttp pyyaml psutil aiofiles

# 3. é…ç½®ç¯å¢ƒå˜é‡
export SLACK_WEBHOOK_URL=your_webhook_url

# 4. å¯åŠ¨ç›‘æ§ç³»ç»Ÿ
python monitoring_integration.py

# 5. éªŒè¯è¿è¡ŒçŠ¶æ€
curl http://localhost:8080/api/status
```

### ğŸ”§ æ•…éšœæ’æŸ¥
```bash
# æ£€æŸ¥ç›‘æ§ç³»ç»ŸçŠ¶æ€
curl http://localhost:8080/api/status

# æŸ¥çœ‹æŒ‡æ ‡æ•°æ®
curl http://localhost:8080/api/metrics

# æ£€æŸ¥å‘Šè­¦çŠ¶æ€
curl http://localhost:8080/api/alerts

# æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/claude-enhancer/monitoring.log
```

### ğŸ“ˆ æ€§èƒ½è°ƒä¼˜
```yaml
# é«˜å¹¶å‘åœºæ™¯ä¼˜åŒ–
metrics:
  collection_interval: 5      # æ›´é¢‘ç¹æ”¶é›†
  batch_size: 1000           # æ‰¹é‡å¤„ç†
  buffer_size: 10000         # å¢å¤§ç¼“å†²åŒº

# èµ„æºå—é™åœºæ™¯ä¼˜åŒ–
metrics:
  collection_interval: 30     # é™ä½é¢‘ç‡
  retention_period: "3d"      # å‡å°‘ä¿ç•™
  sampling_rate: 0.1         # é‡‡æ ·é™é¢‘
```

## ğŸ“š æœ€ä½³å®è·µ

### âœ… ç›‘æ§åŸåˆ™
1. **å››ä¸ªé»„é‡‘ä¿¡å·**: å»¶è¿Ÿã€æµé‡ã€é”™è¯¯ã€é¥±å’Œåº¦
2. **REDæ–¹æ³•**: Rateã€Errorsã€Duration
3. **USEæ–¹æ³•**: Utilizationã€Saturationã€Errors
4. **åˆ†å±‚ç›‘æ§**: åŸºç¡€è®¾æ–½ â†’ åº”ç”¨ â†’ ä¸šåŠ¡

### ğŸ¯ å‘Šè­¦åŸåˆ™
1. **åŸºäºç—‡çŠ¶å‘Šè­¦**: å…³æ³¨ç”¨æˆ·ä½“éªŒå½±å“
2. **å¯æ“ä½œæ€§**: æ¯ä¸ªå‘Šè­¦éƒ½åº”è¯¥æœ‰æ˜ç¡®çš„å¤„ç†æ­¥éª¤
3. **é¿å…å‘Šè­¦ç–²åŠ³**: åˆç†è®¾ç½®é˜ˆå€¼å’Œé¢‘ç‡
4. **åˆ†çº§å¤„ç†**: critical â†’ error â†’ warning â†’ info

### ğŸ“Š ä»ªè¡¨æ¿åŸåˆ™
1. **æ¦‚è§ˆä¼˜å…ˆ**: å…ˆçœ‹æ•´ä½“å†çœ‹ç»†èŠ‚
2. **å…³é”®æŒ‡æ ‡çªå‡º**: é‡è¦ä¿¡æ¯æ”¾åœ¨æ˜¾çœ¼ä½ç½®
3. **æ—¶é—´å¯¹é½**: æ‰€æœ‰å›¾è¡¨ä½¿ç”¨ç›¸åŒæ—¶é—´èŒƒå›´
4. **äº¤äº’æ€§**: æ”¯æŒé’»å–å’Œç­›é€‰

### ğŸ” æ—¥å¿—åŸåˆ™
1. **ç»“æ„åŒ–æ—¥å¿—**: ä½¿ç”¨JSONæ ¼å¼
2. **ç»Ÿä¸€æ ¼å¼**: æ ‡å‡†åŒ–æ—¥å¿—å­—æ®µ
3. **æ•æ„Ÿä¿¡æ¯è¿‡æ»¤**: è‡ªåŠ¨å±è”½å¯†ç ç­‰
4. **åˆç†çº§åˆ«**: DEBUG â†’ INFO â†’ WARN â†’ ERROR

## ğŸ”— ç›¸å…³èµ„æº

### ğŸ“– æ–‡æ¡£é“¾æ¥
- [Prometheuså®˜æ–¹æ–‡æ¡£](https://prometheus.io/docs/)
- [Grafanaå®˜æ–¹æ–‡æ¡£](https://grafana.com/docs/)
- [OpenTelemetryè§„èŒƒ](https://opentelemetry.io/docs/)

### ğŸ› ï¸ å·¥å…·æ¨è
- **Prometheus**: æŒ‡æ ‡æ”¶é›†å’Œå­˜å‚¨
- **Grafana**: å¯è§†åŒ–å’Œä»ªè¡¨æ¿
- **Jaeger**: åˆ†å¸ƒå¼è¿½è¸ª
- **ELK Stack**: æ—¥å¿—èšåˆå’Œæœç´¢

## â“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è°ƒæ•´å‘Šè­¦é˜ˆå€¼ï¼Ÿ
A: ä¿®æ”¹ `monitoring/alerting_rules.yml` æ–‡ä»¶ä¸­çš„é˜ˆå€¼è®¾ç½®ï¼Œç„¶åé‡æ–°åŠ è½½é…ç½®ã€‚

### Q: ç›‘æ§æ•°æ®ä¿ç•™å¤šä¹…ï¼Ÿ
A: é»˜è®¤ä¿ç•™7å¤©ï¼Œå¯é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´ `retention_period` å‚æ•°ã€‚

### Q: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰æŒ‡æ ‡ï¼Ÿ
A: åœ¨åº”ç”¨ä»£ç ä¸­ä½¿ç”¨ `metrics_collector.increment_counter()` ç­‰æ–¹æ³•æ·»åŠ æŒ‡æ ‡ã€‚

### Q: å‘Šè­¦é€šçŸ¥å»¶è¿Ÿæ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œwebhooké…ç½®ï¼Œè€ƒè™‘è°ƒæ•´ `notification_timeout` å‚æ•°ã€‚

---

ğŸ“ **æŠ€æœ¯æ”¯æŒ**: monitoring@claude-enhancer.com
ğŸ› **é—®é¢˜åé¦ˆ**: https://github.com/claude-enhancer/monitoring/issues
ğŸ“š **æ›´å¤šæ–‡æ¡£**: https://docs.claude-enhancer.com/monitoring