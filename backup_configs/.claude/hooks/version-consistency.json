{
  "name": "version-consistency",
  "description": "ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥ - ç¡®ä¿æ‰€æœ‰é…ç½®æ–‡ä»¶ç‰ˆæœ¬å·ä¿æŒä¸€è‡´",
  "event": "SessionStart",
  "matcher": {},
  "action": "#!/bin/bash\nset -euo pipefail\n\n# ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬\nPROJECT_ROOT=\"$(pwd)\"\nVERSION_FILE=\"$PROJECT_ROOT/.vibepilot/VERSION\"\nLOG_FILE=\"$PROJECT_ROOT/eval/logs/version_consistency.log\"\nTIMESTAMP=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\n\n# åˆ›å»ºæ—¥å¿—ç›®å½•\nmkdir -p \"$(dirname \"$LOG_FILE\")\"\n\necho \"[$TIMESTAMP] å¼€å§‹ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥\" >> \"$LOG_FILE\"\n\n# æ£€æŸ¥ç‰ˆæœ¬æ–‡ä»¶æ˜¯å¦å­˜åœ¨\nif [[ ! -f \"$VERSION_FILE\" ]]; then\n    echo \"[$TIMESTAMP] WARNING: ç‰ˆæœ¬æ–‡ä»¶ä¸å­˜åœ¨: $VERSION_FILE\" >> \"$LOG_FILE\"\n    echo \"âš ï¸  ç‰ˆæœ¬æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè·³è¿‡ä¸€è‡´æ€§æ£€æŸ¥\"\n    exit 0\nfi\n\n# è¯»å–å½“å‰ç‰ˆæœ¬\nCURRENT_VERSION=$(cat \"$VERSION_FILE\")\necho \"[$TIMESTAMP] å½“å‰ç‰ˆæœ¬: $CURRENT_VERSION\" >> \"$LOG_FILE\"\n\n# å®šä¹‰éœ€è¦æ£€æŸ¥çš„æ–‡ä»¶å’Œå¯¹åº”çš„ç‰ˆæœ¬æ¨¡å¼\ndeclare -A VERSION_PATTERNS=(\n    [\".claude/settings.json\"]='\"version\": \"([^\"]*)\",'\n    [\".claude/settings-v2.1.json\"]='\"version\": \"([^\"]*)\",'\n    [\"config/vibepilot_max.yaml\"]='version: \"([^\"]*)\"'\n    [\"install.sh\"]='VERSION=\"([^\"]*)\"'\n    [\"scripts/stage_start.sh\"]='VERSION=\"([^\"]*)\"'\n)\n\n# æ£€æŸ¥ç»“æœç»Ÿè®¡\nTOTAL_FILES=0\nMISMATCH_FILES=0\nMISSING_FILES=0\n\n# æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶\nfor file in \"${!VERSION_PATTERNS[@]}\"; do\n    TOTAL_FILES=$((TOTAL_FILES + 1))\n    FULL_PATH=\"$PROJECT_ROOT/$file\"\n    PATTERN=\"${VERSION_PATTERNS[$file]}\"\n    \n    if [[ ! -f \"$FULL_PATH\" ]]; then\n        echo \"[$TIMESTAMP] MISSING: $file\" >> \"$LOG_FILE\"\n        echo \"âŒ æ–‡ä»¶ç¼ºå¤±: $file\"\n        MISSING_FILES=$((MISSING_FILES + 1))\n        continue\n    fi\n    \n    # æå–ç‰ˆæœ¬å·\n    if FOUND_VERSION=$(grep -oP \"$PATTERN\" \"$FULL_PATH\" | head -1 | sed -n 's/.*\"\\([^\"]*\\)\".*/\\1/p'); then\n        if [[ \"$FOUND_VERSION\" == \"$CURRENT_VERSION\" ]]; then\n            echo \"[$TIMESTAMP] OK: $file version $FOUND_VERSION\" >> \"$LOG_FILE\"\n            echo \"âœ… $file: $FOUND_VERSION\"\n        else\n            echo \"[$TIMESTAMP] MISMATCH: $file has $FOUND_VERSION, expected $CURRENT_VERSION\" >> \"$LOG_FILE\"\n            echo \"âš ï¸  ç‰ˆæœ¬ä¸åŒ¹é…: $file ($FOUND_VERSION â‰  $CURRENT_VERSION)\"\n            MISMATCH_FILES=$((MISMATCH_FILES + 1))\n        fi\n    else\n        echo \"[$TIMESTAMP] ERROR: Cannot extract version from $file\" >> \"$LOG_FILE\"\n        echo \"âŒ æ— æ³•æå–ç‰ˆæœ¬: $file\"\n        MISMATCH_FILES=$((MISMATCH_FILES + 1))\n    fi\ndone\n\n# è¾“å‡ºæ€»ç»“\necho \"\"\necho \"ğŸ“Š ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥ç»“æœ:\"\necho \"   æ€»è®¡æ–‡ä»¶: $TOTAL_FILES\"\necho \"   ç‰ˆæœ¬ä¸€è‡´: $((TOTAL_FILES - MISMATCH_FILES - MISSING_FILES))\"\necho \"   ç‰ˆæœ¬ä¸åŒ¹é…: $MISMATCH_FILES\"\necho \"   æ–‡ä»¶ç¼ºå¤±: $MISSING_FILES\"\n\n# è®°å½•æ€»ç»“\necho \"[$TIMESTAMP] æ£€æŸ¥å®Œæˆ - æ€»è®¡:$TOTAL_FILES, ä¸åŒ¹é…:$MISMATCH_FILES, ç¼ºå¤±:$MISSING_FILES\" >> \"$LOG_FILE\"\n\n# æä¾›ä¿®å¤å»ºè®®\nif [[ $MISMATCH_FILES -gt 0 || $MISSING_FILES -gt 0 ]]; then\n    echo \"\"\n    echo \"ğŸ”§ ä¿®å¤å»ºè®®:\"\n    echo \"   è¿è¡Œç‰ˆæœ¬å‡çº§è„šæœ¬: ./scripts/bump-version.sh [type]\"\n    echo \"   æˆ–æ‰‹åŠ¨åŒæ­¥ç‰ˆæœ¬å·åˆ°: $CURRENT_VERSION\"\nfi\n\nexit 0",
  "enabled": true,
  "timeout": 10000,
  "scope": "project"
}