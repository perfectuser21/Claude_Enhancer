{
  "name": "security-guard",
  "description": "å®‰å…¨é˜²æŠ¤é’©å­ - æ‹¦æˆªå±é™©å‘½ä»¤å’Œæ•æ„Ÿæ–‡ä»¶æ“ä½œï¼Œè®°å½•æ‰€æœ‰æ‹¦æˆªè¡Œä¸º",
  "event": "PreToolUse",
  "matcher": {
    "tool": ["Bash", "Edit", "Write", "MultiEdit"]
  },
  "action": "#!/bin/bash\nset -euo pipefail\n\n# è·å–å·¥å…·ç±»å‹å’Œå‚æ•°\nTOOL_TYPE=$(echo \"$CLAUDE_TOOL_INPUT\" | jq -r '.tool_name // \"unknown\"')\nCOMMAND=$(echo \"$CLAUDE_TOOL_INPUT\" | jq -r '.command // \"\"')\nFILE_PATH=$(echo \"$CLAUDE_TOOL_INPUT\" | jq -r '.file_path // \"\"')\n\n# åˆ›å»ºæ—¥å¿—ç›®å½•å’Œæ–‡ä»¶\nmkdir -p eval/logs\nLOG_FILE=\"eval/logs/hook_denies.log\"\nTIMESTAMP=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\n\n# å®šä¹‰å±é™©å‘½ä»¤æ¨¡å¼\nDANGEROUS_PATTERNS=(\n    \"rm -rf\"\n    \"sudo \"\n    \"chmod 777\"\n    \"chown \"\n    \"dd \"\n    \"mkfs\"\n    \"fdisk\"\n    \"format\"\n    \"del /s\"\n    \"rmdir /s\"\n    \"shutdown\"\n    \"reboot\"\n    \"killall\"\n    \"pkill -9\"\n    \":(){ :|:& };:\"\n    \"wget.*|.*sh\"\n    \"curl.*|.*sh\"\n)\n\n# å®šä¹‰æ•æ„Ÿæ–‡ä»¶æ¨¡å¼\nSENSITIVE_PATTERNS=(\n    \"*.env\"\n    \"*/.env*\"\n    \"*/keys/*\"\n    \"*/secrets/*\"\n    \"*/deploy/*\"\n    \"*.key\"\n    \"*.pem\"\n    \"*.crt\"\n    \"*password*\"\n    \"*secret*\"\n    \"*token*\"\n    \"*/etc/passwd\"\n    \"*/etc/shadow\"\n    \"*/etc/hosts\"\n    \"*/.ssh/*\"\n    \"*/config/production*\"\n    \"*/config/prod*\"\n)\n\n# æ£€æŸ¥å±é™©å‘½ä»¤\nif [[ \"$TOOL_TYPE\" == \"Bash\" && -n \"$COMMAND\" ]]; then\n    for pattern in \"${DANGEROUS_PATTERNS[@]}\"; do\n        if echo \"$COMMAND\" | grep -q \"$pattern\"; then\n            echo \"[$TIMESTAMP] BLOCKED: Dangerous command blocked: $COMMAND\" >> \"$LOG_FILE\"\n            echo \"ğŸš¨ å®‰å…¨æ‹¦æˆªï¼šæ£€æµ‹åˆ°å±é™©å‘½ä»¤ '$pattern'ï¼Œå·²é˜»æ­¢æ‰§è¡Œ\"\n            echo \"å‘½ä»¤å†…å®¹ï¼š$COMMAND\"\n            echo \"å¦‚éœ€æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·æ‰‹åŠ¨ç¡®è®¤å®‰å…¨æ€§åæ‰§è¡Œã€‚\"\n            exit 1\n        fi\n    done\nfi\n\n# æ£€æŸ¥æ•æ„Ÿæ–‡ä»¶æ“ä½œ\nif [[ \"$TOOL_TYPE\" =~ ^(Edit|Write|MultiEdit)$ && -n \"$FILE_PATH\" ]]; then\n    for pattern in \"${SENSITIVE_PATTERNS[@]}\"; do\n        # ä½¿ç”¨ç®€å•çš„é€šé…ç¬¦åŒ¹é…\n        if [[ \"$FILE_PATH\" == $pattern ]]; then\n            echo \"[$TIMESTAMP] BLOCKED: Sensitive file access blocked: $FILE_PATH\" >> \"$LOG_FILE\"\n            echo \"ğŸš¨ å®‰å…¨æ‹¦æˆªï¼šæ£€æµ‹åˆ°æ•æ„Ÿæ–‡ä»¶æ“ä½œ '$FILE_PATH'ï¼Œå·²é˜»æ­¢æ‰§è¡Œ\"\n            echo \"æ–‡ä»¶åŒ¹é…æ¨¡å¼ï¼š$pattern\"\n            echo \"å¦‚éœ€ä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œè¯·ç¡®è®¤æ“ä½œå®‰å…¨æ€§å¹¶æ‰‹åŠ¨æ‰§è¡Œã€‚\"\n            exit 1\n        fi\n    done\nfi\n\n# ç‰¹æ®Šæ£€æŸ¥ï¼šå¤§æ‰¹é‡æ–‡ä»¶åˆ é™¤\nif [[ \"$TOOL_TYPE\" == \"Bash\" && \"$COMMAND\" =~ find.*-delete ]]; then\n    echo \"[$TIMESTAMP] BLOCKED: Bulk file deletion blocked: $COMMAND\" >> \"$LOG_FILE\"\n    echo \"ğŸš¨ å®‰å…¨æ‹¦æˆªï¼šæ£€æµ‹åˆ°æ‰¹é‡æ–‡ä»¶åˆ é™¤æ“ä½œï¼Œå·²é˜»æ­¢æ‰§è¡Œ\"\n    echo \"å‘½ä»¤å†…å®¹ï¼š$COMMAND\"\n    exit 1\nfi\n\n# æ£€æŸ¥ç³»ç»Ÿé‡è¦ç›®å½•\nIMPORTANT_DIRS=(\n    \"/etc\"\n    \"/usr\"\n    \"/var\"\n    \"/opt\"\n    \"/boot\"\n    \"/home\"\n    \"/root\"\n)\n\nif [[ \"$TOOL_TYPE\" == \"Bash\" ]]; then\n    for dir in \"${IMPORTANT_DIRS[@]}\"; do\n        if echo \"$COMMAND\" | grep -q \"rm.*$dir\"; then\n            echo \"[$TIMESTAMP] BLOCKED: System directory deletion blocked: $COMMAND\" >> \"$LOG_FILE\"\n            echo \"ğŸš¨ å®‰å…¨æ‹¦æˆªï¼šæ£€æµ‹åˆ°ç³»ç»Ÿé‡è¦ç›®å½•åˆ é™¤æ“ä½œï¼Œå·²é˜»æ­¢æ‰§è¡Œ\"\n            echo \"ç›®æ ‡ç›®å½•ï¼š$dir\"\n            exit 1\n        fi\n    done\nfi\n\n# è®°å½•å…è®¸çš„æ“ä½œï¼ˆç”¨äºç»Ÿè®¡ï¼‰\necho \"[$TIMESTAMP] ALLOWED: $TOOL_TYPE - ${COMMAND:-$FILE_PATH}\" >> \"eval/logs/hook_allows.log\"\n\n# æ“ä½œè¢«å…è®¸\necho \"âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡ï¼Œæ“ä½œå·²æˆæƒæ‰§è¡Œ\"\nexit 0",
  "enabled": true,
  "timeout": 10000,
  "scope": "project"
}